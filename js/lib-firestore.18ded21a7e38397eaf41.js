/*! For license information please see lib-firestore.18ded21a7e38397eaf41.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[839],{8252:(t,e,n)=>{n(3807);var r=n(5205);function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}var s,a=i,u=o;function c(t){if(a===setTimeout)return setTimeout(t,0);if((a===i||!a)&&setTimeout)return a=setTimeout,setTimeout(t,0);try{return a(t,0)}catch(e){try{return a.call(null,t,0)}catch(e){return a.call(this,t,0)}}}"function"==typeof(s="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(a=setTimeout),"function"==typeof s.clearTimeout&&(u=clearTimeout);var h,l=[],f=!1,d=-1;function p(){f&&h&&(f=!1,h.length?l=h.concat(l):d=-1,l.length&&y())}function y(){if(!f){var t=c(p);f=!0;for(var e=l.length;e;){for(h=l,l=[];++d<e;)h&&h[d].run();d=-1,e=l.length}h=null,f=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===o||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function v(){}g.prototype.run=function(){this.fun.apply(null,this.array)};var m=v,w=v,b=v,T=v,I=v,E=v,_=v,S=s.performance||{},D=S.now||S.mozNow||S.msNow||S.oNow||S.webkitNow||function(){return(new Date).getTime()},N=new Date,A={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new g(t,e)),1!==l.length||f||c(y)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:m,addListener:w,once:b,off:T,removeListener:I,removeAllListeners:E,emit:_,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*D.call(S),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-N)/1e3}},k=function(t,e){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},k(t,e)};function C(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var x,R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},L=L||{},O=R||self;function P(){}function F(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function M(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var V="closure_uid_"+(1e9*Math.random()>>>0),U=0;function q(t,e,n){return t.call.apply(t.bind,arguments)}function j(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function B(t,e,n){return(B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?q:j).apply(null,arguments)}function K(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function G(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Q(){this.s=this.s,this.o=this.o}Q.prototype.s=!1,Q.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,V)&&t[V]||(t[V]=++U)}(this)},Q.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function Y(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function X(t){return/^[\s\xa0]*$/.test(t)}var $,J=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Z(t,e){return-1!=t.indexOf(e)}function tt(t,e){return t<e?-1:t>e?1:0}t:{var et=O.navigator;if(et){var nt=et.userAgent;if(nt){$=nt;break t}}$=""}function rt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function it(t){var e={};for(var n in t)e[n]=t[n];return e}var ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function st(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ot.length;o++)n=ot[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function at(t){return at[" "](t),t}at[" "]=P;var ut,ct,ht=Z($,"Opera"),lt=Z($,"Trident")||Z($,"MSIE"),ft=Z($,"Edge"),dt=ft||lt,pt=Z($,"Gecko")&&!(Z($.toLowerCase(),"webkit")&&!Z($,"Edge"))&&!(Z($,"Trident")||Z($,"MSIE"))&&!Z($,"Edge"),yt=Z($.toLowerCase(),"webkit")&&!Z($,"Edge");function gt(){var t=O.document;return t?t.documentMode:void 0}t:{var vt="",mt=(ct=$,pt?/rv:([^\);]+)(\)|;)/.exec(ct):ft?/Edge\/([\d\.]+)/.exec(ct):lt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ct):yt?/WebKit\/(\S+)/.exec(ct):ht?/(?:Version)[ \/]?(\S+)/.exec(ct):void 0);if(mt&&(vt=mt?mt[1]:""),lt){var wt=gt();if(null!=wt&&wt>parseFloat(vt)){ut=String(wt);break t}}ut=vt}var bt,Tt={};function It(){return t=Tt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=J(String(ut)).split("."),n=J("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=tt(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||tt(0==o[2].length,0==s[2].length)||tt(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}O.document&&lt?bt=gt()||parseInt(ut,10)||void 0:bt=void 0;var Et=bt,_t=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{O.addEventListener("test",P,e),O.removeEventListener("test",P,e)}catch(t){}return t}();function St(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Dt(t,e){if(St.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(pt){t:{try{at(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Nt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Dt.Z.h.call(this)}}St.prototype.h=function(){this.defaultPrevented=!0},G(Dt,St);var Nt={2:"touch",3:"pen",4:"mouse"};Dt.prototype.h=function(){Dt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var At="closure_listenable_"+(1e6*Math.random()|0),kt=0;function Ct(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++kt,this.ca=this.fa=!1}function xt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Rt(t){this.src=t,this.g={},this.h=0}function Lt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=z(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(xt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Rt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Ct(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Ft={};function Mt(t,e,n,r,i){if(r&&r.once)return Ut(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Mt(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.N(e,n,M(r)?!!r.capture:!!r,i):Vt(t,e,n,!1,r,i)}function Vt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=M(i)?!!i.capture:!!i,a=Gt(t);if(a||(t[Pt]=a=new Rt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Kt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)_t||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Bt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ut(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.O(e,n,M(r)?!!r.capture:!!r,i):Vt(t,e,n,!0,r,i)}function qt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)qt(t,e[o],n,r,i);else r=M(r)?!!r.capture:!!r,n=zt(n),t&&t[At]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Ot(o=t.g[e],n,r,i))&&(xt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Gt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ot(e,n,r,i)),(n=-1<t?e[t]:null)&&jt(n))}function jt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[At])Lt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Bt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Gt(e))?(Lt(n,t),0==n.h&&(n.src=null,e[Pt]=null)):xt(t)}}}function Bt(t){return t in Ft?Ft[t]:Ft[t]="on"+t}function Kt(t,e){if(t.ca)t=!0;else{e=new Dt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&jt(t),t=n.call(r,e)}return t}function Gt(t){return(t=t[Pt])instanceof Rt?t:null}var Qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(t){return"function"==typeof t?t:(t[Qt]||(t[Qt]=function(e){return t.handleEvent(e)}),t[Qt])}function Ht(){Q.call(this),this.i=new Rt(this),this.P=this,this.I=null}function Wt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new St(e,t);else if(e instanceof St)e.target=e.target||t;else{var i=e;st(e=new St(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Yt(s,r,!0,e)&&i}if(i=Yt(s=e.g=t,r,!0,e)&&i,i=Yt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Yt(s=e.g=n[o],r,!1,e)&&i}function Yt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Lt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}G(Ht,Q),Ht.prototype[At]=!0,Ht.prototype.removeEventListener=function(t,e,n,r){qt(this,t,e,n,r)},Ht.prototype.M=function(){if(Ht.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)xt(n[r]);delete e.g[t],e.h--}}this.I=null},Ht.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ht.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Xt=O.JSON.stringify;function $t(){var t=oe,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Jt,Zt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=te.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),te=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new ee}),(function(t){return t.reset()})),ee=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function ne(t){O.setTimeout((function(){throw t}),0)}function re(t,e){Jt||function(){var t=O.Promise.resolve(void 0);Jt=function(){t.then(se)}}(),ie||(Jt(),ie=!0),oe.add(t,e)}var ie=!1,oe=new Zt;function se(){for(var t;t=$t();){try{t.h.call(t.g)}catch(t){ne(t)}var e=te;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ie=!1}function ae(t,e){Ht.call(this),this.h=t||1,this.g=e||O,this.j=B(this.kb,this),this.l=Date.now()}function ue(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ce(t,e,n){if("function"==typeof t)n&&(t=B(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=B(t.handleEvent,t)}return 2147483647<Number(e)?-1:O.setTimeout(t,e||0)}function he(t){t.g=ce((function(){t.g=null,t.i&&(t.i=!1,he(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}G(ae,Ht),(x=ae.prototype).da=!1,x.S=null,x.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Wt(this,"tick"),this.da&&(ue(this),this.start()))}},x.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},x.M=function(){ae.Z.M.call(this),ue(this),delete this.g};var le=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}k(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:he(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(Q);function fe(t){Q.call(this),this.h=t,this.g={}}G(fe,Q);var de=[];function pe(t,e,n,r){Array.isArray(n)||(n&&(de[0]=n.toString()),n=de);for(var i=0;i<n.length;i++){var o=Mt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ye(t){rt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&jt(t)}),t),t.g={}}function ge(){this.g=!0}function ve(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Xt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}fe.prototype.M=function(){fe.Z.M.call(this),ye(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ge.prototype.Aa=function(){this.g=!1},ge.prototype.info=function(){};var me={},we=null;function be(){return we=we||new Ht}function Te(t){St.call(this,me.Ma,t)}function Ie(t){var e=be();Wt(e,new Te(e,t))}function Ee(t,e){St.call(this,me.STAT_EVENT,t),this.stat=e}function _e(t){var e=be();Wt(e,new Ee(e,t))}function Se(t,e){St.call(this,me.Na,t),this.size=e}function De(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return O.setTimeout((function(){t()}),e)}me.Ma="serverreachability",G(Te,St),me.STAT_EVENT="statevent",G(Ee,St),me.Na="timingevent",G(Se,St);var Ne={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ae={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ke(){}function Ce(t){return t.h||(t.h=t.i())}function xe(){}ke.prototype.h=null;var Re,Le={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Oe(){St.call(this,"d")}function Pe(){St.call(this,"c")}function Fe(){}function Me(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new fe(this),this.P=Ue,t=dt?125:void 0,this.W=new ae(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}G(Oe,St),G(Pe,St),G(Fe,ke),Fe.prototype.g=function(){return new XMLHttpRequest},Fe.prototype.i=function(){return{}},Re=new Fe;var Ue=45e3,qe={},je={};function Be(t,e,n){t.K=1,t.v=fn(sn(e)),t.s=n,t.U=!0,Ke(t,null)}function Ke(t,e){t.F=Date.now(),He(t),t.A=sn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Sn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ve,t.g=Dr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new le(B(t.Ia,t,t.g),t.O)),pe(t.V,t.g,"readystatechange",t.gb),e=t.H?it(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ie(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ge(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Qe(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=ze(t,n))==je){4==e&&(t.o=4,_e(14),i=!1),ve(t.j,t.m,null,"[Incomplete Response]");break}if(r==qe){t.o=4,_e(15),ve(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}ve(t.j,t.m,r,null),Je(t,r)}Ge(t)&&r!=je&&r!=qe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,_e(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),mr(e),e.L=!0,_e(11))):(ve(t.j,t.m,n,"[Invalid Chunked Response]"),$e(t),Xe(t))}function ze(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?je:(n=Number(e.substring(n,r)),isNaN(n)?qe:(r+=1)+n>e.length?je:(e=e.substr(r,n),t.C=r+n,e))}function He(t){t.Y=Date.now()+t.P,We(t,t.P)}function We(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=De(B(t.eb,t),e)}function Ye(t){t.B&&(O.clearTimeout(t.B),t.B=null)}function Xe(t){0==t.l.G||t.I||Tr(t.l,t)}function $e(t){Ye(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ue(t.W),ye(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Je(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Rn(n.i,t)))if(n.I=t.N,!t.J&&Rn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;br(n),cr(n)}vr(n),_e(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=De(B(n.ab,n),6e3));if(1>=xn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Er(n,11)}else if((t.J||n.g==t)&&br(n),!X(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Z(h,"spdy")||Z(h,"quic")||Z(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Ln(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,ln(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Sr(r,r.H?r.la:null,r.W),d.J){On(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(Ye(p),He(p)),r.g=d}else gr(r);0<n.l.length&&fr(n)}else"stop"!=o[0]&&"close"!=o[0]||Er(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Er(n,7):ur(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Ie(4)}catch(o){}}function Ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(F(t)||"string"==typeof t)H(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(F(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(F(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function tn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof tn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function en(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];nn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)nn(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function nn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(x=Me.prototype).setTimeout=function(t){this.P=t},x.gb=function(t){t=t.target;var e=this.L;e&&3==rr(t)?e.l():this.Ia(t)},x.Ia=function(t){try{if(t==this.g)t:{var e=rr(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||dt||this.g&&(this.h.h||this.g.ga()||ir(this.g)))){this.I||4!=e||7==n||Ie(8==n||0>=r?3:2),Ye(this);var i=this.g.ba();this.N=i;e:if(Ge(this)){var o=ir(this.g);t="";var s=o.length,a=4==rr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),Xe(this);var u="";break e}this.h.i=new O.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!X(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,_e(12),$e(this),Xe(this);break t}ve(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Je(this,i)}this.U?(Qe(this,e,u),dt&&this.i&&3==e&&(pe(this.V,this.W,"tick",this.fb),this.W.start())):(ve(this.j,this.m,u,null),Je(this,u)),4==e&&$e(this),this.i&&!this.I&&(4==e?Tr(this.l,this):(this.i=!1,He(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,_e(12)):(this.o=0,_e(13)),$e(this),Xe(this)}}}catch(e){}},x.fb=function(){if(this.g){var t=rr(this.g),e=this.g.ga();this.C<e.length&&(Ye(this),Qe(this,t,e),this.i&&4!=t&&He(this))}},x.cancel=function(){this.I=!0,$e(this)},x.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Ie(3),_e(17)),$e(this),this.o=2,Xe(this)):We(this,this.Y-t)},(x=tn.prototype).R=function(){en(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},x.T=function(){return en(this),this.g.concat()},x.get=function(t,e){return nn(this.h,t)?this.h[t]:e},x.set=function(t,e){nn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},x.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var rn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function on(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof on){this.g=void 0!==e?e:t.g,an(this,t.j),this.s=t.s,un(this,t.i),cn(this,t.m),this.l=t.l,e=t.h;var n=new Tn;n.i=e.i,e.g&&(n.g=new tn(e.g),n.h=e.h),hn(this,n),this.o=t.o}else t&&(n=String(t).match(rn))?(this.g=!!e,an(this,n[1]||"",!0),this.s=dn(n[2]||""),un(this,n[3]||"",!0),cn(this,n[4]),this.l=dn(n[5]||"",!0),hn(this,n[6]||"",!0),this.o=dn(n[7]||"")):(this.g=!!e,this.h=new Tn(null,this.g))}function sn(t){return new on(t)}function an(t,e,n){t.j=n?dn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function un(t,e,n){t.i=n?dn(e,!0):e}function cn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function hn(t,e,n){e instanceof Tn?(t.h=e,function(t,e){e&&!t.j&&(In(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(En(this,e),Sn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=pn(e,wn)),t.h=new Tn(e,t.g))}function ln(t,e,n){t.h.set(e,n)}function fn(t){return ln(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function dn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function pn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,yn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function yn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}on.prototype.toString=function(){var t=[],e=this.j;e&&t.push(pn(e,gn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(pn(e,gn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(pn(n,"/"==n.charAt(0)?mn:vn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",pn(n,bn)),t.join("")};var gn=/[#\/\?@]/g,vn=/[#\?:]/g,mn=/[#\?]/g,wn=/[#\?@]/g,bn=/#/g;function Tn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function In(t){t.g||(t.g=new tn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function En(t,e){In(t),e=Dn(t,e),nn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,nn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&en(t)))}function _n(t,e){return In(t),e=Dn(t,e),nn(t.g.h,e)}function Sn(t,e,n){En(t,e),0<n.length&&(t.i=null,t.g.set(Dn(t,e),Y(n)),t.h+=n.length)}function Dn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(x=Tn.prototype).add=function(t,e){In(this),this.i=null,t=Dn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},x.forEach=function(t,e){In(this),this.g.forEach((function(n,r){H(n,(function(n){t.call(e,n,r,this)}),this)}),this)},x.T=function(){In(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},x.R=function(t){In(this);var e=[];if("string"==typeof t)_n(this,t)&&(e=W(e,this.g.get(Dn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},x.set=function(t,e){return In(this),this.i=null,_n(this,t=Dn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},x.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},x.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Nn=function(t,e){this.h=t,this.g=e};function An(t){this.l=t||kn,t=O.PerformanceNavigationTiming?0<(t=O.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(O.g&&O.g.Ea&&O.g.Ea()&&O.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var kn=10;function Cn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function xn(t){return t.h?1:t.g?t.g.size:0}function Rn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ln(t,e){t.g?t.g.add(e):t.h=e}function On(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Pn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=C(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return Y(t.i)}function Fn(){}function Mn(){this.g=new Fn}function Vn(t,e,n){var r=n||"";try{Ze(t,(function(t,n){var i=t;M(t)&&(i=Xt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Un(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function qn(t){this.l=t.$b||null,this.j=t.ib||!1}function jn(t,e){Ht.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Bn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}An.prototype.cancel=function(){var t,e;if(this.i=Pn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=C(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Fn.prototype.stringify=function(t){return O.JSON.stringify(t,void 0)},Fn.prototype.parse=function(t){return O.JSON.parse(t,void 0)},G(qn,ke),qn.prototype.g=function(){return new jn(this.l,this.j)},qn.prototype.i=function(t){return function(){return t}}({}),G(jn,Ht);var Bn=0;function Kn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Gn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Qn(t)}function Qn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(x=jn.prototype).open=function(t,e){if(this.readyState!=Bn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Qn(this)},x.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||O).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},x.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Gn(this)),this.readyState=Bn},x.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Qn(this)),this.g&&(this.readyState=3,Qn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==O.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Kn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},x.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Gn(this):Qn(this),3==this.readyState&&Kn(this)}},x.Ua=function(t){this.g&&(this.response=this.responseText=t,Gn(this))},x.Ta=function(t){this.g&&(this.response=t,Gn(this))},x.ha=function(){this.g&&Gn(this)},x.setRequestHeader=function(t,e){this.v.append(t,e)},x.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},x.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(jn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var zn=O.JSON.parse;function Hn(t){Ht.call(this),this.headers=new tn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wn,this.K=this.L=!1}G(Hn,Ht);var Wn="",Yn=/^https?$/i,Xn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function Jn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Zn(t),er(t)}function Zn(t){t.D||(t.D=!0,Wt(t,"complete"),Wt(t,"error"))}function tr(t){if(t.h&&void 0!==L&&(!t.C[1]||4!=rr(t)||2!=t.ba()))if(t.v&&4==rr(t))ce(t.Fa,0,t);else if(Wt(t,"readystatechange"),4==rr(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(rn)[1]||null;if(!o&&O.self&&O.self.location){var s=O.self.location.protocol;o=s.substr(0,s.length-1)}i=!Yn.test(o?o.toLowerCase():"")}e=i}if(e)Wt(t,"complete"),Wt(t,"success");else{t.m=6;try{var a=2<rr(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Zn(t)}}finally{er(t)}}}function er(t,e){if(t.g){nr(t);var n=t.g,r=t.C[0]?P:null;t.g=null,t.C=null,e||Wt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function nr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(O.clearTimeout(t.A),t.A=null)}function rr(t){return t.g?t.g.readyState:0}function ir(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Wn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function or(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return rt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ln(t,e,n))}function sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function ar(t){this.za=0,this.l=[],this.h=new ge,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=sr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=sr("baseRetryDelayMs",5e3,t),this.$a=sr("retryDelaySeedMs",1e4,t),this.Ya=sr("forwardChannelMaxRetries",2,t),this.ra=sr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new An(t&&t.concurrentRequestLimit),this.Ca=new Mn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ur(t){if(hr(t),3==t.G){var e=t.V++,n=sn(t.F);ln(n,"SID",t.J),ln(n,"RID",e),ln(n,"TYPE","terminate"),pr(t,n),(e=new Me(t,t.h,e,void 0)).K=2,e.v=fn(sn(n)),n=!1,O.navigator&&O.navigator.sendBeacon&&(n=O.navigator.sendBeacon(e.v.toString(),"")),!n&&O.Image&&((new Image).src=e.v,n=!0),n||(e.g=Dr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),He(e)}_r(t)}function cr(t){t.g&&(mr(t),t.g.cancel(),t.g=null)}function hr(t){cr(t),t.u&&(O.clearTimeout(t.u),t.u=null),br(t),t.i.cancel(),t.m&&("number"==typeof t.m&&O.clearTimeout(t.m),t.m=null)}function lr(t,e){t.l.push(new Nn(t.Za++,e)),3==t.G&&fr(t)}function fr(t){Cn(t.i)||t.m||(t.m=!0,re(t.Ha,t),t.C=0)}function dr(t,e){var n;n=e?e.m:t.V++;var r=sn(t.F);ln(r,"SID",t.J),ln(r,"RID",n),ln(r,"AID",t.U),pr(t,r),t.o&&t.s&&or(r,t.o,t.s),n=new Me(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=yr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Ln(t.i,n),Be(n,r,e)}function pr(t,e){t.j&&Ze({},(function(t,n){ln(e,n,t)}))}function yr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?B(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{Vn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function gr(t){t.g||t.u||(t.Y=1,re(t.Ga,t),t.A=0)}function vr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=De(B(t.Ga,t),Ir(t,t.A)),t.A++,0))}function mr(t){null!=t.B&&(O.clearTimeout(t.B),t.B=null)}function wr(t){t.g=new Me(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=sn(t.oa);ln(e,"RID","rpc"),ln(e,"SID",t.J),ln(e,"CI",t.N?"0":"1"),ln(e,"AID",t.U),pr(t,e),ln(e,"TYPE","xmlhttp"),t.o&&t.s&&or(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=fn(sn(e)),n.s=null,n.U=!0,Ke(n,t)}function br(t){null!=t.v&&(O.clearTimeout(t.v),t.v=null)}function Tr(t,e){var n=null;if(t.g==e){br(t),mr(t),t.g=null;var r=2}else{if(!Rn(t.i,e))return;n=e.D,On(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Wt(r=be(),new Se(r,n,e,i)),fr(t)}else gr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(xn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=De(B(t.Ha,t,e),Ir(t,t.C)),t.C++,0)))}(t,e)||2==r&&vr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Er(t,5);break;case 4:Er(t,10);break;case 3:Er(t,6);break;default:Er(t,2)}}function Ir(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Er(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=B(t.jb,t);n||(n=new on("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||an(n,"https"),fn(n)),function(t,e){var n=new ge;if(O.Image){var r=new Image;r.onload=K(Un,n,r,"TestLoadImage: loaded",!0,e),r.onerror=K(Un,n,r,"TestLoadImage: error",!1,e),r.onabort=K(Un,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=K(Un,n,r,"TestLoadImage: timeout",!1,e),O.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else _e(2);t.G=0,t.j&&t.j.va(e),_r(t),hr(t)}function _r(t){t.G=0,t.I=-1,t.j&&(0==Pn(t.i).length&&0==t.l.length||(t.i.i.length=0,Y(t.l),t.l.length=0),t.j.ua())}function Sr(t,e,n){var r=function(t){return t instanceof on?sn(t):new on(t,void 0)}(n);if(""!=r.i)e&&un(r,e+"."+r.i),cn(r,r.m);else{var i=O.location;r=function(t,e,n,r){var i=new on(null,void 0);return t&&an(i,t),e&&un(i,e),n&&cn(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&rt(t.aa,(function(t,e){ln(r,e,t)})),e=t.D,n=t.sa,e&&n&&ln(r,e,n),ln(r,"VER",t.ma),pr(t,r),r}function Dr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Hn(new qn({ib:!0})):new Hn(t.qa)).L=t.H,e}function Nr(){}function Ar(){if(lt&&!(10<=Number(Et)))throw Error("Environmental error: no available transport.")}function kr(t,e){Ht.call(this),this.g=new ar(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!X(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!X(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Rr(this)}function Cr(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function xr(){Pe.call(this),this.status=1}function Rr(t){this.g=t}(x=Hn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Re.g(),this.C=this.u?Ce(this.u):Ce(Re),this.g.onreadystatechange=B(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Jn(this,t)}t=n||"";var i=new tn(this.headers);r&&Ze(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=$n,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=O.FormData&&t instanceof O.FormData,!(0<=z(Xn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{nr(this),0<this.B&&((this.K=function(t){return lt&&It()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=B(this.pa,this)):this.A=ce(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Jn(this,t)}},x.pa=function(){void 0!==L&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Wt(this,"timeout"),this.abort(8))},x.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Wt(this,"complete"),Wt(this,"abort"),er(this))},x.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),er(this,!0)),Hn.Z.M.call(this)},x.Fa=function(){this.s||(this.F||this.v||this.l?tr(this):this.cb())},x.cb=function(){tr(this)},x.ba=function(){try{return 2<rr(this)?this.g.status:-1}catch(t){return-1}},x.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},x.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),zn(e)}},x.Da=function(){return this.m},x.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(x=ar.prototype).ma=8,x.G=1,x.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},x.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Me(this,this.h,t,void 0),n=this.s;if(this.P&&(n?st(n=it(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=yr(this,e,r),ln(i=sn(this.F),"RID",t),ln(i,"CVER",22),this.D&&ln(i,"X-HTTP-Session-Id",this.D),pr(this,i),this.o&&n&&or(i,this.o,n),Ln(this.i,e),this.Ra&&ln(i,"TYPE","init"),this.ja?(ln(i,"$req",r),ln(i,"SID","null"),e.$=!0,Be(e,i,null)):Be(e,i,r),this.G=2}}else 3==this.G&&(t?dr(this,t):0==this.l.length||Cn(this.i)||dr(this))},x.Ga=function(){if(this.u=null,wr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=De(B(this.bb,this),t)}},x.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,_e(10),cr(this),wr(this))},x.ab=function(){null!=this.v&&(this.v=null,cr(this),vr(this),_e(19))},x.jb=function(t){t?(this.h.info("Successfully pinged google.com"),_e(2)):(this.h.info("Failed to ping google.com"),_e(1))},(x=Nr.prototype).xa=function(){},x.wa=function(){},x.va=function(){},x.ua=function(){},x.Oa=function(){},Ar.prototype.g=function(t,e){return new kr(t,e)},G(kr,Ht),kr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),re(B(t.hb,t,e))),_e(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Sr(t,null,t.W),fr(t)},kr.prototype.close=function(){ur(this.g)},kr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,lr(this.g,e)}else this.v?((e={}).__data__=Xt(t),lr(this.g,e)):lr(this.g,t)},kr.prototype.M=function(){this.g.j=null,delete this.j,ur(this.g),delete this.g,kr.Z.M.call(this)},G(Cr,Oe),G(xr,Pe),G(Rr,Nr),Rr.prototype.xa=function(){Wt(this.g,"a")},Rr.prototype.wa=function(t){Wt(this.g,new Cr(t))},Rr.prototype.va=function(t){Wt(this.g,new xr(t))},Rr.prototype.ua=function(){Wt(this.g,"b")},Ar.prototype.createWebChannel=Ar.prototype.g,kr.prototype.send=kr.prototype.u,kr.prototype.open=kr.prototype.m,kr.prototype.close=kr.prototype.close,Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Ae.COMPLETE="complete",xe.EventType=Le,Le.OPEN="a",Le.CLOSE="b",Le.ERROR="c",Le.MESSAGE="d",Ht.prototype.listen=Ht.prototype.N,Hn.prototype.listenOnce=Hn.prototype.O,Hn.prototype.getLastError=Hn.prototype.La,Hn.prototype.getLastErrorCode=Hn.prototype.Da,Hn.prototype.getStatus=Hn.prototype.ba,Hn.prototype.getResponseJson=Hn.prototype.Qa,Hn.prototype.getResponseText=Hn.prototype.ga,Hn.prototype.send=Hn.prototype.ea;var Lr=Ne,Or=Ae,Pr=me,Fr=qn,Mr=xe,Vr=Hn,Ur=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Ur.o=-1;var qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},jr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,r._)(e,t),e}(Error),Br=new r.p("@firebase/firestore");function Kr(){return Br.logLevel}function Gr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=r.L.DEBUG){var i=e.map(Hr);Br.debug.apply(Br,(0,r.a)(["Firestore (8.10.0): "+t],i))}}function Qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=r.L.ERROR){var i=e.map(Hr);Br.error.apply(Br,(0,r.a)(["Firestore (8.10.0): "+t],i))}}function zr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=r.L.WARN){var i=e.map(Hr);Br.warn.apply(Br,(0,r.a)(["Firestore (8.10.0): "+t],i))}}function Hr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Wr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.0) INTERNAL ASSERTION FAILED: "+t;throw Qr(e),new Error(e)}function Yr(t,e){t||Wr()}function Xr(t,e){return t}function $r(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Jr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=$r(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Zr(t,e){return t<e?-1:t>e?1:0}function ti(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function ei(t){return t+"\0"}var ni=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new jr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new jr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new jr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Zr(this.nanoseconds,t.nanoseconds):Zr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),ri=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ni(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ii(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function si(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ai=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Wr(),void 0===n?n=t.length-e:n>t.length-e&&Wr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new jr(qr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ai),ci=/^[_a-zA-Z][_a-zA-Z0-9]*$/,hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ci.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new jr(qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new jr(qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new jr(qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new jr(qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ai),li=function(){function t(t){this.fields=t,t.sort(hi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return ti(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),fi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Zr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();fi.EMPTY_BYTE_STRING=new fi("");var di=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pi(t){if(Yr(!!t),"string"==typeof t){var e=0,n=di.exec(t);if(Yr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:yi(t.seconds),nanos:yi(t.nanos)}}function yi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function gi(t){return"string"==typeof t?fi.fromBase64String(t):fi.fromUint8Array(t)}function vi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function mi(t){var e=t.mapValue.fields.__previous_value__;return vi(e)?mi(e):e}function wi(t){var e=pi(t.mapValue.fields.__local_write_time__.timestampValue);return new ni(e.seconds,e.nanos)}function bi(t){return null==t}function Ti(t){return 0===t&&1/t==-1/0}function Ii(t){return"number"==typeof t&&Number.isInteger(t)&&!Ti(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ei=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ui.fromString(e))},t.fromName=function(e){return new t(ui.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ui.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ui.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ui(e.slice()))},t}();function _i(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vi(t)?4:10:Wr()}function Si(t,e){var n=_i(t);if(n!==_i(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return wi(t).isEqual(wi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=pi(t.timestampValue),r=pi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return gi(t.bytesValue).isEqual(gi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return yi(t.geoPointValue.latitude)===yi(e.geoPointValue.latitude)&&yi(t.geoPointValue.longitude)===yi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return yi(t.integerValue)===yi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=yi(t.doubleValue),r=yi(e.doubleValue);return n===r?Ti(n)===Ti(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ti(t.arrayValue.values||[],e.arrayValue.values||[],Si);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ii(n)!==ii(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Si(n[i],r[i])))return!1;return!0}(t,e);default:return Wr()}}function Di(t,e){return void 0!==(t.values||[]).find((function(t){return Si(t,e)}))}function Ni(t,e){var n=_i(t),r=_i(e);if(n!==r)return Zr(n,r);switch(n){case 0:return 0;case 1:return Zr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=yi(t.integerValue||t.doubleValue),r=yi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ai(t.timestampValue,e.timestampValue);case 4:return Ai(wi(t),wi(e));case 5:return Zr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=gi(t),r=gi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Zr(n[i],r[i]);if(0!==o)return o}return Zr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Zr(yi(t.latitude),yi(e.latitude));return 0!==n?n:Zr(yi(t.longitude),yi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ni(n[i],r[i]);if(o)return o}return Zr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Zr(r[s],o[s]);if(0!==a)return a;var u=Ni(n[r[s]],i[o[s]]);if(0!==u)return u}return Zr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Wr()}}function Ai(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Zr(t,e);var n=pi(t),r=pi(e),i=Zr(n.seconds,r.seconds);return 0!==i?i:Zr(n.nanos,r.nanos)}function ki(t){return Ci(t)}function Ci(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=pi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?gi(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Ei.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ci(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ci(t.fields[o])}return e+"}"}(t.mapValue):Wr();var e,n}function xi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ri(t){return!!t&&"integerValue"in t}function Li(t){return!!t&&"arrayValue"in t}function Oi(t){return!!t&&"nullValue"in t}function Pi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Fi(t){return!!t&&"mapValue"in t}function Mi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return oi(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=Mi(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Mi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Vi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Fi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Mi(e)},t.prototype.setAll=function(t){var e=this,n=hi.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Mi(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Si(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){oi(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(Mi(this.value))},t}();function Ui(t){var e=[];return oi(t.fields,(function(t,n){var r=new hi([t]);if(Fi(n)){var i=Ui(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new li(e)}var qi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,ri.min(),Vi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Vi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Vi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Vi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Vi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),ji=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Bi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ji(t,e,n,r,i,o,s)}function Ki(t){var e=Xr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+ki(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),bi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=no(e.startAt)),e.endAt&&(n+="|ub:",n+=no(e.endAt)),e.h=n}return e.h}function Gi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!io(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Si(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!so(t.startAt,e.startAt)&&so(t.endAt,e.endAt)}function Qi(t){return Ei.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var zi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,r._)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Hi(t,n,r):"array-contains"===n?new $i(t,r):"in"===n?new Ji(t,r):"not-in"===n?new Zi(t,r):"array-contains-any"===n?new to(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Wi(t,n):new Yi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ni(e,this.value)):null!==e&&_i(this.value)===_i(e)&&this.m(Ni(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Wr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Hi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ei.fromName(r.referenceValue),i}return(0,r._)(e,t),e.prototype.matches=function(t){var e=Ei.comparator(t.key,this.key);return this.m(e)},e}(zi),Wi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Xi(0,n),r}return(0,r._)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(zi),Yi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Xi(0,n),r}return(0,r._)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(zi);function Xi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Ei.fromName(t.referenceValue)}))}var $i=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,r._)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Li(e)&&Di(e.arrayValue,this.value)},e}(zi),Ji=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,r._)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Di(this.value.arrayValue,e)},e}(zi),Zi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,r._)(e,t),e.prototype.matches=function(t){if(Di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Di(this.value.arrayValue,e)},e}(zi),to=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,r._)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Li(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Di(e.value.arrayValue,t)}))},e}(zi),eo=function(t,e){this.position=t,this.before=e};function no(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ki(t)})).join(",")}var ro=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function io(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function oo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ei.comparator(Ei.fromName(s.referenceValue),n.key):Ni(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function so(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Si(t.position[n],e.position[n]))return!1;return!0}var ao=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function uo(t,e,n,r,i,o,s,a){return new ao(t,e,n,r,i,o,s,a)}function co(t){return new ao(t)}function ho(t){return!bi(t.limit)&&"F"===t.limitType}function lo(t){return!bi(t.limit)&&"L"===t.limitType}function fo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function po(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function yo(t){return null!==t.collectionGroup}function go(t){var e=Xr(t);if(null===e.p){e.p=[];var n=po(e),r=fo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ro(n)),e.p.push(new ro(hi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ro(hi.keyField(),u))}}}return e.p}function vo(t){var e=Xr(t);if(!e.T)if("F"===e.limitType)e.T=Bi(e.path,e.collectionGroup,go(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=go(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ro(o.field,s))}var a=e.endAt?new eo(e.endAt.position,!e.endAt.before):null,u=e.startAt?new eo(e.startAt.position,!e.startAt.before):null;e.T=Bi(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function mo(t,e,n){return new ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function wo(t,e){return Gi(vo(t),vo(e))&&t.limitType===e.limitType}function bo(t){return Ki(vo(t))+"|lt:"+t.limitType}function To(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+ki(e.value);var e})).join(", ")+"]"),bi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+no(t.startAt)),t.endAt&&(e+=", endAt: "+no(t.endAt)),"Target("+e+")"}(vo(t))+"; limitType="+t.limitType+")"}function Io(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ei.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!oo(t.startAt,go(t),e)||t.endAt&&oo(t.endAt,go(t),e))}(t,e)}function Eo(t){return function(e,n){for(var r=!1,i=0,o=go(t);i<o.length;i++){var s=o[i],a=_o(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function _o(t,e,n){var r=t.field.isKeyField()?Ei.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ni(r,i):Wr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Wr()}}function So(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ti(e)?"-0":e}}function Do(t){return{integerValue:""+t}}function No(t,e){return Ii(e)?Do(e):So(t,e)}var Ao=function(){this._=void 0};function ko(t,e,n){return t instanceof Ro?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Lo?Oo(t,e):t instanceof Po?Fo(t,e):function(t,e){var n=xo(t,e),r=Vo(n)+Vo(t.A);return Ri(n)&&Ri(t.A)?Do(r):So(t.R,r)}(t,e)}function Co(t,e,n){return t instanceof Lo?Oo(t,e):t instanceof Po?Fo(t,e):n}function xo(t,e){return t instanceof Mo?Ri(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Ro=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e}(Ao),Lo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,r._)(e,t),e}(Ao);function Oo(t,e){for(var n=Uo(e),r=function(t){n.some((function(e){return Si(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Po=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,r._)(e,t),e}(Ao);function Fo(t,e){for(var n=Uo(e),r=function(t){n=n.filter((function(e){return!Si(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Mo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,r._)(e,t),e}(Ao);function Vo(t){return yi(t.integerValue||t.doubleValue)}function Uo(t){return Li(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var qo=function(t,e){this.field=t,this.transform=e},jo=function(t,e){this.version=t,this.transformResults=e},Bo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ko(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Go=function(){};function Qo(t,e,n){t instanceof Xo?function(t,e,n){var r=t.value.clone(),i=Zo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof $o?function(t,e,n){if(Ko(t.precondition,e)){var r=Zo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Jo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function zo(t,e,n){t instanceof Xo?function(t,e,n){if(Ko(t.precondition,e)){var r=t.value.clone(),i=ts(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Yo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof $o?function(t,e,n){if(Ko(t.precondition,e)){var r=ts(t.fieldTransforms,n,e),i=e.data;i.setAll(Jo(t)),i.setAll(r),e.convertToFoundDocument(Yo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Ko(t.precondition,e)&&e.convertToNoDocument(ri.min())}(t,e)}function Ho(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=xo(o.transform,s||null);null!=a&&(null==n&&(n=Vi.empty()),n.set(o.field,a))}return n||null}function Wo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ti(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Lo&&e instanceof Lo||t instanceof Po&&e instanceof Po?ti(t.elements,e.elements,Si):t instanceof Mo&&e instanceof Mo?Si(t.A,e.A):t instanceof Ro&&e instanceof Ro}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Yo(t){return t.isFoundDocument()?t.version:ri.min()}var Xo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,r._)(e,t),e}(Go),$o=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,r._)(e,t),e}(Go);function Jo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Zo(t,e,n){var r=new Map;Yr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Co(s,a,n[i]))}return r}function ts(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,ko(a,u,e))}return r}var es,ns,rs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,r._)(e,t),e}(Go),is=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,r._)(e,t),e}(Go),os=function(t){this.count=t};function ss(t){switch(t){default:return Wr();case qr.CANCELLED:case qr.UNKNOWN:case qr.DEADLINE_EXCEEDED:case qr.RESOURCE_EXHAUSTED:case qr.INTERNAL:case qr.UNAVAILABLE:case qr.UNAUTHENTICATED:return!1;case qr.INVALID_ARGUMENT:case qr.NOT_FOUND:case qr.ALREADY_EXISTS:case qr.PERMISSION_DENIED:case qr.FAILED_PRECONDITION:case qr.ABORTED:case qr.OUT_OF_RANGE:case qr.UNIMPLEMENTED:case qr.DATA_LOSS:return!0}}function as(t){if(void 0===t)return Qr("GRPC error has no .code"),qr.UNKNOWN;switch(t){case es.OK:return qr.OK;case es.CANCELLED:return qr.CANCELLED;case es.UNKNOWN:return qr.UNKNOWN;case es.DEADLINE_EXCEEDED:return qr.DEADLINE_EXCEEDED;case es.RESOURCE_EXHAUSTED:return qr.RESOURCE_EXHAUSTED;case es.INTERNAL:return qr.INTERNAL;case es.UNAVAILABLE:return qr.UNAVAILABLE;case es.UNAUTHENTICATED:return qr.UNAUTHENTICATED;case es.INVALID_ARGUMENT:return qr.INVALID_ARGUMENT;case es.NOT_FOUND:return qr.NOT_FOUND;case es.ALREADY_EXISTS:return qr.ALREADY_EXISTS;case es.PERMISSION_DENIED:return qr.PERMISSION_DENIED;case es.FAILED_PRECONDITION:return qr.FAILED_PRECONDITION;case es.ABORTED:return qr.ABORTED;case es.OUT_OF_RANGE:return qr.OUT_OF_RANGE;case es.UNIMPLEMENTED:return qr.UNIMPLEMENTED;case es.DATA_LOSS:return qr.DATA_LOSS;default:return Wr()}}(ns=es||(es={}))[ns.OK=0]="OK",ns[ns.CANCELLED=1]="CANCELLED",ns[ns.UNKNOWN=2]="UNKNOWN",ns[ns.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ns[ns.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ns[ns.NOT_FOUND=5]="NOT_FOUND",ns[ns.ALREADY_EXISTS=6]="ALREADY_EXISTS",ns[ns.PERMISSION_DENIED=7]="PERMISSION_DENIED",ns[ns.UNAUTHENTICATED=16]="UNAUTHENTICATED",ns[ns.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ns[ns.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ns[ns.ABORTED=10]="ABORTED",ns[ns.OUT_OF_RANGE=11]="OUT_OF_RANGE",ns[ns.UNIMPLEMENTED=12]="UNIMPLEMENTED",ns[ns.INTERNAL=13]="INTERNAL",ns[ns.UNAVAILABLE=14]="UNAVAILABLE",ns[ns.DATA_LOSS=15]="DATA_LOSS";var us=function(){function t(t,e){this.comparator=t,this.root=e||hs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,hs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new cs(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new cs(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new cs(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new cs(this.root,t,this.comparator,!0)},t}(),cs=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),hs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Wr();if(this.right.isRed())throw Wr();var t=this.left.check();if(t!==this.right.check())throw Wr();return t+(this.isRed()?0:1)},t}();hs.EMPTY=null,hs.RED=!0,hs.BLACK=!1,hs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new hs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ls=function(){function t(t){this.comparator=t,this.data=new us(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new fs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new fs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),fs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ds=new us(Ei.comparator);function ps(){return ds}var ys=new us(Ei.comparator);function gs(){return ys}var vs=new us(Ei.comparator),ms=new ls(Ei.comparator);function ws(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ms,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var bs=new ls(Zr);function Ts(){return bs}var Is=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Es.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(ri.min(),r,Ts(),ps(),ws())},t}(),Es=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(fi.EMPTY_BYTE_STRING,n,ws(),ws(),ws())},t}(),_s=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Ss=function(t,e){this.targetId=t,this.V=e},Ds=function(t,e,n,r){void 0===n&&(n=fi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ns=function(){function t(){this.S=0,this.D=Cs(),this.C=fi.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=ws(),e=ws(),n=ws();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Wr()}})),new Es(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=Cs()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),As=function(){function t(t){this.W=t,this.G=new Map,this.H=ps(),this.J=ks(),this.Y=new ls(Zr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Wr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Qi(i))if(0===n){var o=new Ei(i.path);this.tt(e,o,qi.newNoDocument(o,ri.min()))}else Yr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Qi(o.target)){var s=new Ei(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,qi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=ws();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Is(t,n,this.Y,this.H,r);return this.H=ps(),this.J=ks(),this.Y=new ls(Zr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ns,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ls(Zr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Gr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Ns),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ks(){return new us(Ei.comparator)}function Cs(){return new us(Ei.comparator)}var xs={asc:"ASCENDING",desc:"DESCENDING"},Rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ls=function(t,e){this.databaseId=t,this.I=e};function Os(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ps(t,e){return t.I?e.toBase64():e.toUint8Array()}function Fs(t,e){return Os(t,e.toTimestamp())}function Ms(t){return Yr(!!t),ri.fromTimestamp(function(t){var e=pi(t);return new ni(e.seconds,e.nanos)}(t))}function Vs(t,e){return function(t){return new ui(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Us(t){var e=ui.fromString(t);return Yr(ua(e)),e}function qs(t,e){return Vs(t.databaseId,e.path)}function js(t,e){var n=Us(e);if(n.get(1)!==t.databaseId.projectId)throw new jr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new jr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ei(Qs(n))}function Bs(t,e){return Vs(t.databaseId,e)}function Ks(t){var e=Us(t);return 4===e.length?ui.emptyPath():Qs(e)}function Gs(t){return new ui(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Qs(t){return Yr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function zs(t,e,n){return{name:qs(t,e),fields:n.value.mapValue.fields}}function Hs(t,e){var n;if(e instanceof Xo)n={update:zs(t,e.key,e.value)};else if(e instanceof rs)n={delete:qs(t,e.key)};else if(e instanceof $o)n={update:zs(t,e.key,e.data),updateMask:aa(e.fieldMask)};else{if(!(e instanceof is))return Wr();n={verify:qs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Ro)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Lo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Po)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Mo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Wr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Fs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Wr()}(t,e.precondition)),n}function Ws(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Bo.updateTime(Ms(t.updateTime)):void 0!==t.exists?Bo.exists(t.exists):Bo.none()}(e.currentDocument):Bo.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Yr("REQUEST_TIME"===e.setToServerValue),n=new Ro;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Lo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Po(i)}else"increment"in e?n=new Mo(t,e.increment):Wr();var o=hi.fromServerFormat(e.fieldPath);return new qo(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=js(t,e.update.name),o=new Vi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new li(e.map((function(t){return hi.fromServerFormat(t)})))}(e.updateMask);return new $o(i,o,s,n,r)}return new Xo(i,o,n,r)}if(e.delete){var a=js(t,e.delete);return new rs(a,n)}if(e.verify){var u=js(t,e.verify);return new is(u,n)}return Wr()}function Ys(t,e){return{documents:[Bs(t,e.path)]}}function Xs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Bs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Bs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Pi(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NAN"}};if(Oi(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pi(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NOT_NAN"}};if(Oi(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ra(t.field),op:na(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:ra(t.field),direction:ea(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||bi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Zs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Zs(e.endAt)),n}function $s(t){var e=Ks(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Yr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Js(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new ro(ia(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return bi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ta(n.startAt));var h=null;return n.endAt&&(h=ta(n.endAt)),uo(e,i,a,s,u,"F",c,h)}function Js(t){return t?void 0!==t.unaryFilter?[sa(t)]:void 0!==t.fieldFilter?[oa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Js(t)})).reduce((function(t,e){return t.concat(e)})):Wr():[]}function Zs(t){return{before:t.before,values:t.position}}function ta(t){var e=!!t.before,n=t.values||[];return new eo(n,e)}function ea(t){return xs[t]}function na(t){return Rs[t]}function ra(t){return{fieldPath:t.canonicalString()}}function ia(t){return hi.fromServerFormat(t.fieldPath)}function oa(t){return zi.create(ia(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Wr()}}(t.fieldFilter.op),t.fieldFilter.value)}function sa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ia(t.unaryFilter.field);return zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ia(t.unaryFilter.field);return zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ia(t.unaryFilter.field);return zi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ia(t.unaryFilter.field);return zi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Wr()}}function aa(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function ua(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ca(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=la(e)),e=ha(t.get(n),e);return la(e)}function ha(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function la(t){return t+""}function fa(t){var e=t.length;if(Yr(e>=2),2===e)return Yr(""===t.charAt(0)&&""===t.charAt(1)),ui.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Wr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Wr()}o=s+2}return new ui(r)}var da=function(t,e){this.seconds=t,this.nanoseconds=e},pa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};pa.store="owner",pa.key="owner";var ya=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ya.store="mutationQueues",ya.keyPath="userId";var ga=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ga.store="mutations",ga.keyPath="batchId",ga.userMutationsIndex="userMutationsIndex",ga.userMutationsKeyPath=["userId","batchId"];var va=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ca(e)]},t.key=function(t,e,n){return[t,ca(e),n]},t}();va.store="documentMutations",va.PLACEHOLDER=new va;var ma=function(t,e){this.path=t,this.readTime=e},wa=function(t,e){this.path=t,this.version=e},ba=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ba.store="remoteDocuments",ba.readTimeIndex="readTimeIndex",ba.readTimeIndexPath="readTime",ba.collectionReadTimeIndex="collectionReadTimeIndex",ba.collectionReadTimeIndexPath=["parentPath","readTime"];var Ta=function(t){this.byteSize=t};Ta.store="remoteDocumentGlobal",Ta.key="remoteDocumentGlobalKey";var Ia=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ia.store="targets",Ia.keyPath="targetId",Ia.queryTargetsIndexName="queryTargetsIndex",Ia.queryTargetsKeyPath=["canonicalId","targetId"];var Ea=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ea.store="targetDocuments",Ea.keyPath=["targetId","path"],Ea.documentTargetsIndex="documentTargetsIndex",Ea.documentTargetsKeyPath=["path","targetId"];var _a=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};_a.key="targetGlobalKey",_a.store="targetGlobal";var Sa=function(t,e){this.collectionId=t,this.parent=e};Sa.store="collectionParents",Sa.keyPath=["collectionId","parent"];var Da=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Da.store="clientMetadata",Da.keyPath="clientId";var Na=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Na.store="bundles",Na.keyPath="bundleId";var Aa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Aa.store="namedQueries",Aa.keyPath="name";var ka=(0,r.a)((0,r.a)([],(0,r.a)((0,r.a)([],(0,r.a)((0,r.a)([],(0,r.a)((0,r.a)([],[ya.store,ga.store,va.store,ba.store,Ia.store,pa.store,_a.store,Ea.store]),[Da.store])),[Ta.store])),[Sa.store])),[Na.store,Aa.store]),Ca="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",xa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Ra=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},La=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Oa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ra,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ma(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ba(e.target.error);n.ft.reject(new Ma(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ma(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Gr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ua(e)},t}(),Pa=function(){function t(e,n,i){this.name=e,this.version=n,this.wt=i,12.2===t._t((0,r.g)())&&Qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Gr("SimpleDb","Removing database:",t),qa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,r.g)(),n=t._t(e),i=0<n&&n<10,o=t.Et(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)},t.gt=function(){var t;return void 0!==A&&"YES"===(null===(t=A.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n=this;return(0,r.c)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Gr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Ma(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new jr(qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Ma(t,n))},i.onupgradeneeded=function(t){Gr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){Gr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,i){return(0,r.b)(this,void 0,void 0,(function(){var o,s,a,u,c;return(0,r.c)(this,(function(h){switch(h.label){case 0:o="readonly"===e,s=0,a=function(){var e,a,c,h,l;return(0,r.c)(this,(function(r){switch(r.label){case 0:++s,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=r.sent(),e=Oa.open(u.db,t,o?"readonly":"readwrite",n),a=i(e).catch((function(t){return e.abort(t),La.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(r.sent(),a),c)];case 4:return h=r.sent(),l="FirebaseError"!==h.name&&s<3,Gr("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Fa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return qa(this.Pt.delete())},t}(),Ma=function(t){function e(e,n){var r=this;return(r=t.call(this,qr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,r._)(e,t),e}(jr);function Va(t){return"IndexedDbTransactionError"===t.name}var Ua=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Gr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Gr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qa(n)},t.prototype.add=function(t){return Gr("SimpleDb","ADD",this.store.name,t,t),qa(this.store.add(t))},t.prototype.get=function(t){var e=this;return qa(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Gr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return Gr("SimpleDb","DELETE",this.store.name,t),qa(this.store.delete(t))},t.prototype.count=function(){return Gr("SimpleDb","COUNT",this.store.name),qa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){Gr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new La((function(n,r){e.onerror=function(t){var e=Ba(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new La((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Fa(i),s=e(i.primaryKey,i.value,o);if(s instanceof La){var a=s.catch((function(t){return o.done(),La.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return La.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function qa(t){return new La((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Ba(t.target.error);n(e)}}))}var ja=!1;function Ba(t){var e=Pa._t((0,r.g)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new jr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ja||(ja=!0,setTimeout((function(){throw i}),0)),i}}return t}var Ka=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,r._)(e,t),e}(xa);function Ga(t,e){var n=Xr(t);return Pa.It(n.Mt,e)}var Qa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Qo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ri.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),ws())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ti(this.mutations,t.mutations,(function(t,e){return Wo(t,e)}))&&ti(this.baseMutations,t.baseMutations,(function(t,e){return Wo(t,e)}))},t}(),za=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Yr(e.mutations.length===r.length);for(var i=vs,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Ha=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=ri.min()),void 0===o&&(o=ri.min()),void 0===s&&(s=fi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Wa=function(t){this.Lt=t};function Ya(t,e){if(e.document)return function(t,e,n){var r=js(t,e.name),i=Ms(e.updateTime),o=new Vi({mapValue:{fields:e.fields}}),s=qi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ei.fromSegments(e.noDocument.path),r=tu(e.noDocument.readTime),i=qi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ei.fromSegments(e.unknownDocument.path);return r=tu(e.unknownDocument.version),qi.newUnknownDocument(o,r)}return Wr()}function Xa(t,e,n){var r=$a(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:qs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Os(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ba(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Za(e.version);return s=e.hasCommittedMutations,new ba(null,new ma(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Za(e.version);return new ba(new wa(c,h),null,null,!0,r,i)}return Wr()}function $a(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ja(t){var e=new ni(t[0],t[1]);return ri.fromTimestamp(e)}function Za(t){var e=t.toTimestamp();return new da(e.seconds,e.nanoseconds)}function tu(t){var e=new ni(t.seconds,t.nanoseconds);return ri.fromTimestamp(e)}function eu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ws(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Ws(t.Lt,e)})),a=ni.fromMillis(e.localWriteTimeMs);return new Qa(e.batchId,a,n,s)}function nu(t){var e,n,r=tu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?tu(t.lastLimboFreeSnapshotVersion):ri.min();return void 0!==t.query.documents?(Yr(1===(n=t.query).documents.length),e=vo(co(Ks(n.documents[0])))):e=function(t){return vo($s(t))}(t.query),new Ha(e,t.targetId,0,t.lastListenSequenceNumber,r,i,fi.fromBase64String(t.resumeToken))}function ru(t,e){var n,r=Za(e.snapshotVersion),i=Za(e.lastLimboFreeSnapshotVersion);n=Qi(e.target)?Ys(t.Lt,e.target):Xs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ia(e.targetId,Ki(e.target),r,o,e.sequenceNumber,i,n)}function iu(t){var e=$s({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?mo(e,e.limit,"L"):e}var ou=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return su(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:tu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return su(t).put({bundleId:(n=e).id,createTime:Za(Ms(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return au(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:iu(e.bundledQuery),readTime:tu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return au(t).put(function(t){return{name:t.name,readTime:Za(Ms(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function su(t){return Ga(t,Na.store)}function au(t){return Ga(t,Aa.store)}var uu=function(){function t(){this.Bt=new cu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),La.resolve()},t.prototype.getCollectionParents=function(t,e){return La.resolve(this.Bt.getEntries(e))},t}(),cu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ls(ui.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ls(ui.comparator)).toArray()},t}(),hu=function(){function t(){this.qt=new cu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:ca(i)};return lu(t).put(o)}return La.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ei(e),""],!1,!0);return lu(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(fa(o.parent))}return n}))},t}();function lu(t){return Ga(t,Sa.store)}var fu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},du=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function pu(t,e,n){var r=t.store(ga.store),i=t.store(va.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Yr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=va.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return La.waitFor(o).next((function(){return c}))}function yu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Wr();e=t.noDocument}return JSON.stringify(e).length}du.DEFAULT_COLLECTION_PERCENTILE=10,du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,du.DEFAULT=new du(41943040,du.DEFAULT_COLLECTION_PERCENTILE,du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),du.DISABLED=new du(-1,0,0);var gu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Yr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mu(t).$t({index:ga.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=wu(t),s=mu(t);return s.add({}).next((function(a){Yr("number"==typeof a);for(var u=new Qa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Hs(t.Lt,e)})),i=n.mutations.map((function(e){return Hs(t.Lt,e)}));return new ga(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ls((function(t,e){return Zr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=va.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,va.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),La.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return mu(t).get(e).next((function(t){return t?(Yr(t.userId===n.userId),eu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?La.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return mu(t).$t({index:ga.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Yr(e.batchId>=r),o=eu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return mu(t).$t({index:ga.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mu(t).Nt(ga.userMutationsIndex,n).next((function(t){return t.map((function(t){return eu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=va.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return wu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=fa(u);if(a===n.userId&&e.path.isEqual(h))return mu(t).get(c).next((function(t){if(!t)throw Wr();Yr(t.userId===n.userId),o.push(eu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ls(Zr),i=[];return e.forEach((function(e){var o=va.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=wu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=fa(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),La.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=va.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ls(Zr);return wu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=fa(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(mu(t).get(e).next((function(t){if(null===t)throw Wr();Yr(t.userId===n.userId),r.push(eu(n.R,t))})))})),La.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return pu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),La.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return La.resolve();var r=IDBKeyRange.lowerBound(va.prefixForUser(e.userId)),i=[];return wu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=fa(t[1]);i.push(o)}else r.done()})).next((function(){Yr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return vu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return bu(t).get(this.userId).next((function(t){return t||new ya(e.userId,-1,"")}))},t}();function vu(t,e,n){var r=va.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return wu(t).$t({range:o,Ft:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function mu(t){return Ga(t,ga.store)}function wu(t){return Ga(t,va.store)}function bu(t){return Ga(t,ya.store)}var Tu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Iu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Tu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return ri.fromTimestamp(new ni(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Eu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Yr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Eu(t).$t((function(s,a){var u=nu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return La.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Eu(t).$t((function(t,n){var r=nu(n);e(r)}))},t.prototype.Xt=function(t){return _u(t).get(_a.key).next((function(t){return Yr(null!==t),t}))},t.prototype.Zt=function(t,e){return _u(t).put(_a.key,e)},t.prototype.te=function(t,e){return Eu(t).put(ru(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Ki(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Eu(t).$t({range:r,index:Ia.queryTargetsIndexName},(function(t,n,r){var o=nu(n);Gi(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Su(t);return e.forEach((function(e){var s=ca(e.path);i.push(o.put(new Ea(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),La.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Su(t);return La.forEach(e,(function(e){var o=ca(e.path);return La.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Su(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Su(t),i=ws();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=fa(t[1]),o=new Ei(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=ca(e.path),r=IDBKeyRange.bound([n],[ei(n)],!1,!0),i=0;return Su(t).$t({index:Ea.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return Eu(t).get(e).next((function(t){return t?nu(t):null}))},t}();function Eu(t){return Ga(t,Ia.store)}function _u(t){return Ga(t,_a.store)}function Su(t){return Ga(t,Ea.store)}function Du(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){if(t.code!==qr.FAILED_PRECONDITION||t.message!==Ca)throw t;return Gr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Nu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Zr(n,i);return 0===s?Zr(r,o):s}var Au=function(){function t(t){this.ne=t,this.buffer=new ls(Nu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Nu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),ku=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Gr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return(0,r.b)(e,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Va(e=n.sent())?(Gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Du(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Cu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return La.resolve(Ur.o);var r=new Au(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Gr("LruGarbageCollector","Garbage collection skipped; disabled"),La.resolve(fu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Gr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),fu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(Gr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),i=h.params.maximumSequenceNumbersToCollect):i=e,s=Date.now(),h.nthSequenceNumber(t,i)})).next((function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return o=e,u=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),Kr()<=r.L.DEBUG&&Gr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),La.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})}))},t}(),xu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Cu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return Ru(t,n)},t.prototype.removeReference=function(t,e,n){return Ru(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Ru(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return bu(t).Ot((function(r){return vu(t,r,e).next((function(t){return t&&(n=!0),La.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Su(t).delete([0,ca(s.path)])}))}));i.push(u)}})).next((function(){return La.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Ru(t,e)},t.prototype.we=function(t,e){var n,r=Su(t),i=Ur.o;return r.$t({index:Ea.documentTargetsIndex},(function(t,r){var o=t[0];t[1];var s=r.path,a=r.sequenceNumber;0===o?(i!==Ur.o&&e(new Ei(fa(n)),i),i=a,n=s):i=Ur.o})).next((function(){i!==Ur.o&&e(new Ei(fa(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Ru(t,e){return Su(t).put(function(t,e){return new Ea(0,ca(t.path),e)}(e,t.currentSequenceNumber))}var Lu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){oi(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return si(this.inner)},t}(),Ou=function(){function t(){this.changes=new Lu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:ri.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:qi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?La.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Pu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Vu(t).put(Uu(e),n)},t.prototype.removeEntry=function(t,e){var n=Vu(t),r=Uu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Vu(t).get(Uu(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Vu(t).get(Uu(e)).next((function(t){return{document:n.ye(e,t),size:yu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=ps();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=ps(),i=new us(Ei.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,yu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return La.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Vu(t).$t({range:r},(function(t,e,r){for(var s=Ei.fromSegments(t);o&&Ei.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=ps(),o=e.path.length+1,s={};if(n.isEqual(ri.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=$a(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ba.collectionReadTimeIndex}return Vu(t).$t(s,(function(t,n,s){if(t.length===o){var a=Ya(r.R,n);e.path.isPrefixOf(a.key.path)?Io(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new Fu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Mu(t).get(Ta.key).next((function(t){return Yr(!!t),t}))},t.prototype.me=function(t,e){return Mu(t).put(Ta.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ya(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(ri.min()))return n}return qi.newInvalidDocument(t)},t}(),Fu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Lu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return(0,r._)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ls((function(t,e){return Zr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Xa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=yu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Xa(e.Ie.R,qi.newNoDocument(o,ri.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),La.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(Ou);function Mu(t){return Ga(t,Ta.store)}function Vu(t){return Ga(t,ba.store)}function Uu(t){return t.path.toArray()}var qu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Yr(n<r&&n>=0&&r<=11);var o=new Oa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(pa.store)}(t),function(t){t.createObjectStore(ya.store,{keyPath:ya.keyPath}),t.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0}).createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0}),t.createObjectStore(va.store)}(t),ju(t),function(t){t.createObjectStore(ba.store)}(t));var s=La.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ea.store),t.deleteObjectStore(Ia.store),t.deleteObjectStore(_a.store)}(t),ju(t)),s=s.next((function(){return function(t){var e=t.store(_a.store),n=new _a(0,0,ri.min().toTimestamp(),0);return e.put(_a.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ga.store).Nt().next((function(n){t.deleteObjectStore(ga.store),t.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0}).createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0});var r=e.store(ga.store),i=n.map((function(t){return r.put(t)}));return La.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ta.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ba.store);e.createIndex(ba.readTimeIndex,ba.readTimeIndexPath,{unique:!1}),e.createIndex(ba.collectionReadTimeIndex,ba.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Na.store,{keyPath:Na.keyPath})}(t),function(t){t.createObjectStore(Aa.store,{keyPath:Aa.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ba.store).$t((function(t,n){e+=yu(n)})).next((function(){var n=new Ta(e);return t.store(Ta.store).put(Ta.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(ya.store),r=t.store(ga.store);return n.Nt().next((function(n){return La.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ga.userMutationsIndex,i).next((function(r){return La.forEach(r,(function(r){Yr(r.userId===n.userId);var i=eu(e.R,r);return pu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(Ea.store),n=t.store(ba.store);return t.store(_a.store).get(_a.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new ui(n),s=function(t){return[0,ca(t)]}(o);r.push(e.get(s).next((function(n){return n?La.resolve():function(n){return e.put(new Ea(0,ca(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return La.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath});var n=e.store(Sa.store),r=new cu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ca(i)})}};return e.store(ba.store).$t({Ft:!0},(function(t,e){var n=new ui(t);return i(n.popLast())})).next((function(){return e.store(va.store).$t({Ft:!0},(function(t,e){t[0];var n=t[1];t[2];var r=fa(n);return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Ia.store);return n.$t((function(t,r){var i=nu(r),o=ru(e.R,i);return n.put(o)}))},t}();function ju(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}).createIndex(Ea.documentTargetsIndex,Ea.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ia.store,{keyPath:Ia.keyPath}).createIndex(Ia.queryTargetsIndexName,Ia.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(_a.store)}var Bu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ku=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new jr(qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xu(this,i),this.Le=n+"main",this.R=new Wa(u),this.Be=new Pa(this.Le,11,new qu(this.R)),this.qe=new Iu(this.referenceDelegate,this.R),this.Ut=new hu,this.Ue=function(t,e){return new Pu(t,e)}(this.R,this.Ut),this.Ke=new ou,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new jr(qr.FAILED_PRECONDITION,Bu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Ur(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,r.b)(e,void 0,void 0,(function(){return(0,r.c)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return(0,r.b)(e,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return(0,r.b)(e,void 0,void 0,(function(){return(0,r.c)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Qu(e).put(new Da(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Va(e))return Gr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Gu(t).get(pa.key).next((function(t){return La.resolve(e.tn(t))}))},t.prototype.en=function(t){return Qu(t).delete(this.clientId)},t.prototype.nn=function(){return(0,r.b)(this,void 0,void 0,(function(){var t,e,n,i,o=this;return(0,r.c)(this,(function(r){switch(r.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Ga(t,Da.store);return e.Nt().next((function(t){var n=o.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return La.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=r.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)i=n[e],this.Qe.removeItem(this.on(i.clientId));r.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?La.resolve(!0):Gu(t).get(pa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new jr(qr.FAILED_PRECONDITION,Bu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Qu(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Gr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return(0,r.b)(this,void 0,void 0,(function(){var t=this;return(0,r.c)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[pa.store,Da.store],(function(e){var n=new Ka(e,Ur.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Qu(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return gu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Gr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,ka,(function(o){return i=new Ka(o,r.Ne?r.Ne.next():Ur.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Qr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new jr(qr.FAILED_PRECONDITION,Ca);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Gu(t).get(pa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(qr.FAILED_PRECONDITION,Bu)}))},t.prototype.Ze=function(t){var e=new pa(this.clientId,this.allowTabSynchronization,Date.now());return Gu(t).put(pa.key,e)},t.yt=function(){return Pa.yt()},t.prototype.Xe=function(t){var e=this,n=Gu(t);return n.get(pa.key).next((function(t){return e.tn(t)?(Gr("IndexedDbPersistence","Releasing primary lease."),n.delete(pa.key)):La.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Qr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),(0,r.d)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Gr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Qr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Gu(t){return Ga(t,pa.store)}function Qu(t){return Ga(t,Da.store)}function zu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Hu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ei.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):yo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ei(e)).next((function(t){var e=gs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=gs();return this.Ut.getCollectionParents(t,i).next((function(s){return La.forEach(s,(function(s){var a=function(t,e){return new ao(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=qi.newInvalidDocument(c),r=r.insert(c,h)),zo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Io(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=ws(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof $o&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Wu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ws(),i=ws(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Yu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ri.min())?this.Dn(t,e):this.Sn.pn(t,i).next((function(s){var a=o.Cn(e,s);return(ho(e)||lo(e))&&o.Nn(e.limitType,a,i,n)?o.Dn(t,e):(Kr()<=r.L.DEBUG&&Gr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),To(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new ls(Eo(t));return e.forEach((function(e,r){Io(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Kr()<=r.L.DEBUG&&Gr("QueryEngine","Using full collection scan to execute query:",To(e)),this.Sn.getDocumentsMatchingQuery(t,e,ri.min())},t}(),Xu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new us(Zr),this.Fn=new Lu((function(t){return Ki(t)}),Gi),this.$n=ri.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Hu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function $u(t,e,n,r){return new Xu(t,e,n,r)}function Ju(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Xr(t),i=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var r;return n._n.getAllMutationBatches(t).next((function(s){return r=s,i=n.persistence.getMutationQueue(e),o=new Hu(n.On,i,n.persistence.getIndexManager()),i.getAllMutationBatches(t)})).next((function(e){for(var n=[],i=[],s=ws(),a=0,u=r;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];i.push(y.batchId);for(var g=0,v=y.mutations;g<v.length;g++){var m=v[g];s=s.add(m.key)}}return o.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:i}}))}))}))];case 1:return s=r.sent(),[2,(n._n=i,n.Mn=o,n.xn.Vn(n.Mn),s)]}}))}))}function Zu(t,e){var n=Xr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=La.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Yr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function tc(t){var e=Xr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function ec(t,e){var n=Xr(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Yr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=ps();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(function(t,e,n,r,i){var o=ws();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var i=ps();return n.forEach((function(n,o){var s=t.get(n),a=r;o.isNoDocument()&&o.version.isEqual(ri.min())?(e.removeEntry(n,a),i=i.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(o,a),i=i.insert(n,o)):Gr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),i}))}(t,o,e.documentUpdates,r).next((function(t){a=t}))),!r.isEqual(ri.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return La.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function nc(t,e){var n=Xr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function rc(t,e){var n=Xr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,La.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new Ha(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function ic(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a;return(0,r.c)(this,(function(r){switch(r.label){case 0:i=Xr(t),o=i.kn.get(e),s=n?"readwrite":"readwrite-primary",r.label=1;case 1:return r.trys.push([1,4,,5]),n?[3,3]:[4,i.persistence.runTransaction("Release target",s,(function(t){return i.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if(!Va(a=r.sent()))throw a;return Gr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return i.kn=i.kn.remove(e),i.Fn.delete(o.target),[2]}}))}))}function oc(t,e,n){var r=Xr(t),i=ri.min(),o=ws();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Xr(t),i=r.Fn.get(n);return void 0!==i?La.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,vo(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:ri.min(),n?o:ws())})).next((function(t){return{documents:t,Bn:o}}))}))}function sc(t,e){var n=Xr(t),r=Xr(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function ac(t){var e=Xr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Xr(t),i=ps(),o=$a(n),s=Vu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ba.readTimeIndex,range:a},(function(t,e){var n=Ya(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Ja(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn,r=t.readTime;return e.$n=r,n}))}function uc(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){return[2,(e=Xr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Vu(t),n=ri.min();return e.$t({index:ba.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ja(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}var cc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return La.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ms(n.createTime)}),La.resolve()},t.prototype.getNamedQuery=function(t,e){return La.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:iu(t.bundledQuery),readTime:Ms(t.readTime)}}(e)),La.resolve()},t}(),hc=function(){function t(){this.Wn=new ls(lc.Gn),this.zn=new ls(lc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new lc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new lc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Ei(new ui([])),r=new lc(n,t),i=new lc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ei(new ui([])),n=new lc(e,t),r=new lc(e,t+1),i=ws();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new lc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),lc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ei.comparator(t.key,e.key)||Zr(t.ns,e.ns)},t.Hn=function(t,e){return Zr(t.ns,e.ns)||Ei.comparator(t.key,e.key)},t}(),fc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ls(lc.Gn)}return t.prototype.checkEmpty=function(t){return La.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Qa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new lc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return La.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return La.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return La.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return La.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return La.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new lc(e,0),i=new lc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),La.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ls(Zr);return e.forEach((function(t){var e=new lc(t,0),i=new lc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),La.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ei.isDocumentKey(i)||(i=i.child(""));var o=new lc(new Ei(i),0),s=new ls(Zr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),La.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Yr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return La.forEach(e.mutations,(function(i){var o=new lc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new lc(e,0),r=this.rs.firstAfterOrEqual(n);return La.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,La.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),dc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new us(Ei.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return La.resolve(n?n.document.clone():qi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=ps();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():qi.newInvalidDocument(t))})),La.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=ps(),i=new Ei(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Io(e,c)&&(r=r.insert(c.key,c.clone()))}return La.resolve(r)},t.prototype.fs=function(t,e){return La.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new pc(this)},t.prototype.getSize=function(t){return La.resolve(this.size)},t}(),pc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,r._)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),La.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Ou),yc=function(){function t(t){this.persistence=t,this.ds=new Lu((function(t){return Ki(t)}),Gi),this.lastRemoteSnapshotVersion=ri.min(),this.highestTargetId=0,this.ws=0,this._s=new hc,this.targetCount=0,this.ys=Tu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),La.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return La.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return La.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),La.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),La.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Tu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,La.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),La.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,La.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),La.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return La.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return La.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),La.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),La.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),La.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return La.resolve(n)},t.prototype.containsKey=function(t,e){return La.resolve(this._s.containsKey(e))},t}(),gc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Ur(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new yc(this),this.Ut=new uu,this.Ue=function(t,e){return new dc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Wa(e),this.Ke=new cc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new fc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Gr("MemoryPersistence","Starting transaction:",t);var i=new vc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return La.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),vc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,r._)(e,t),e}(xa),mc=function(){function t(t){this.persistence=t,this.As=new hc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Wr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),La.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),La.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),La.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return La.forEach(this.vs,(function(r){var i=Ei.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return La.or([function(){return La.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),wc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function bc(t,e){return"firestore_clients_"+t+"_"+e}function Tc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Ic(t,e){return"firestore_targets_"+t+"_"+e}wc.UNAUTHENTICATED=new wc(null),wc.GOOGLE_CREDENTIALS=new wc("google-credentials-uid"),wc.FIRST_PARTY=new wc("first-party-uid"),wc.MOCK_USER=new wc("mock-user");var Ec=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new jr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Qr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),_c=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new jr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Qr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Sc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ts(),s=0;i&&s<r.activeTargetIds.length;++s)i=Ii(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Qr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Dc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Qr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Nc=function(){function t(){this.activeTargetIds=Ts()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ac=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new us(Zr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=bc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Nc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,r.b)(this,void 0,void 0,(function(){var t,e,n,i,o,s,a,u,c,h,l,f=this;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=r.sent(),e=0,n=t;e<n.length;e++)(i=n[e])!==this.Ns&&(o=this.getItem(bc(this.persistenceKey,i)))&&(s=Sc.Vs(i,o))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Ic(this.persistenceKey,t));if(n){var r=_c.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Ic(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Gr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Gr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Gr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Gr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return(0,r.b)(e,void 0,void 0,(function(){var t,e,i,o,s,a;return(0,r.c)(this,(function(r){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(i=this.si(n.key,n.newValue)))return[2,this.ii(i)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(o=this.ri(n.key,n.newValue)))return[2,this.oi(o)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=Ur.o;if(null!=t)try{var n=JSON.parse(t);Yr("number"==typeof n),e=n}catch(t){Qr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Ur.o&&this.sequenceNumberHandler(a);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Ec(this.currentUser,t,e,n),i=Tc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Tc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Ic(this.persistenceKey,t),i=new _c(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Sc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ec.Vs(new wc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return _c.Vs(r,e)},t.prototype.js=function(t){return Dc.Vs(t)},t.prototype.ii=function(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Gr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ts();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),kc=function(){function t(){this.li=new Nc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Nc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Cc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),xc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Rc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Lc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Oc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,r._)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new Vr;s.listenOnce(Or.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Lr.NO_ERROR:var e=s.getResponseJson();Gr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Lr.TIMEOUT:Gr("Connection",'RPC "'+t+'" timed out'),o(new jr(qr.DEADLINE_EXCEEDED,"Request time out"));break;case Lr.HTTP_ERROR:var n=s.getStatus();if(Gr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(qr).indexOf(e)>=0?e:qr.UNKNOWN}(r.status);o(new jr(a,r.message))}else o(new jr(qr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new jr(qr.UNAVAILABLE,"Connection failed."));break;default:Wr()}}finally{Gr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new Ar,o=be(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new Fr({})),this.ki(s.initMessageHeaders,e),(0,r.e)()||(0,r.h)()||(0,r.j)()||(0,r.k)()||(0,r.l)()||(0,r.m)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");Gr("Connection","Creating WebChannel: "+a,s);var u=i.createWebChannel(a,s),c=!1,h=!1,l=new Lc({Ei:function(t){h?Gr("Connection","Not sending because WebChannel is closed:",t):(c||(Gr("Connection","Opening WebChannel transport."),u.open(),c=!0),Gr("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,Mr.EventType.OPEN,(function(){h||Gr("Connection","WebChannel transport opened.")})),f(u,Mr.EventType.CLOSE,(function(){h||(h=!0,Gr("Connection","WebChannel transport closed"),l.Vi())})),f(u,Mr.EventType.ERROR,(function(t){h||(h=!0,zr("Connection","WebChannel transport errored:",t),l.Vi(new jr(qr.UNAVAILABLE,"The operation could not be completed")))})),f(u,Mr.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Yr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Gr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=es[t];if(void 0!==e)return as(e)}(o),a=i.message;void 0===s&&(s=qr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new jr(s,a)),u.close()}else Gr("Connection","WebChannel received:",n),l.Si(n)}})),f(o,Pr.STAT_EVENT,(function(t){10===t.stat?Gr("Connection","Detected buffering proxy"):11===t.stat&&Gr("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Gr("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return Gr("RestConnection","Received: ",t),t}),(function(e){throw zr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=Rc[t];return this.Di+"/v1/"+e+":"+n},t}());function Pc(){return"undefined"!=typeof window?window:null}function Fc(){return"undefined"!=typeof document?document:null}function Mc(t){return new Ls(t,!0)}var Vc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Gr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Uc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Vc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===qr.RESOURCE_EXHAUSTED?(Qr(e.toString()),Qr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===qr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new jr(qr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return(0,r.b)(t,void 0,void 0,(function(){return(0,r.c)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return Gr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),qc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,r._)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Wr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Yr(void 0===e||"string"==typeof e),fi.fromBase64String(e||"")):(Yr(void 0===e||e instanceof Uint8Array),fi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?qr.UNKNOWN:as(t.code);return new jr(e,t.message||"")}(a);n=new Ds(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=js(t,r.document.name),o=Ms(r.document.updateTime);var a=new Vi({mapValue:{fields:r.document.fields}}),u=(s=qi.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new _s(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=js(t,r.document),o=r.readTime?Ms(r.readTime):ri.min(),a=qi.newNoDocument(i,o),s=r.removedTargetIds||[],n=new _s([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=js(t,r.document),o=r.removedTargetIds||[],n=new _s([],o,i,null);else{if(!("filter"in e))return Wr();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new os(r),o=h.targetId,n=new Ss(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return ri.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?ri.min():e.readTime?Ms(e.readTime):ri.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Gs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Qi(r)?{documents:Ys(t,r)}:{query:Xs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ps(t,e.resumeToken):e.snapshotVersion.compareTo(ri.min())>0&&(n.readTime=Os(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Wr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Gs(this.R),e.removeTarget=t,this.cr(e)},e}(Uc),jc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,r._)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Yr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Yr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Ms(t.updateTime):Ms(e);return n.isEqual(ri.min())&&(n=Ms(e)),new jo(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Ms(t.commitTime);return this.listener.Tr(n,e)}return Yr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Gs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Hs(e.R,t)}))};this.cr(n)},e}(Uc),Bc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,r._)(e,t),e.prototype.br=function(){if(this.Rr)throw new jr(qr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(qr.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new jr(qr.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),Kc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Qr(e),this.Vr=!1):Gr("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Gc=function(t,e,n,i,o){var s=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di((function(t){n.enqueueAndForget((function(){return(0,r.b)(s,void 0,void 0,(function(){return(0,r.c)(this,(function(t){switch(t.label){case 0:return Zc(this)?(Gr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return(e=Xr(t)).Or.add(4),[4,zc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Qc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Kc(n,i)};function Qc(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n;return(0,r.c)(this,(function(r){switch(r.label){case 0:if(!Zc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function zc(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n;return(0,r.c)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Hc(t,e){var n=Xr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Jc(n)?$c(n):ph(n).er()&&Yc(n,e))}function Wc(t,e){var n=Xr(t),r=ph(n);n.$r.delete(e),r.er()&&Xc(n,e),0===n.$r.size&&(r.er()?r.ir():Zc(n)&&n.Br.set("Unknown"))}function Yc(t,e){t.qr.U(e.targetId),ph(t).mr(e)}function Xc(t,e){t.qr.U(e),ph(t).yr(e)}function $c(t){t.qr=new As({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),ph(t).start(),t.Br.Sr()}function Jc(t){return Zc(t)&&!ph(t).tr()&&t.$r.size>0}function Zc(t){return 0===Xr(t).Or.size}function th(t){t.qr=void 0}function eh(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){return t.$r.forEach((function(e,n){Yc(t,e)})),[2]}))}))}function nh(t,e){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(n){return th(t),Jc(t)?(t.Br.Nr(e),$c(t)):t.Br.set("Unknown"),[2]}))}))}function rh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s;return(0,r.c)(this,(function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof Ds&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s;return(0,r.c)(this,(function(r){switch(r.label){case 0:n=e.cause,i=0,o=e.targetIds,r.label=1;case 1:return i<o.length?(s=o[i],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:r.sent(),t.$r.delete(s),t.qr.removeTarget(s),r.label=3;case 3:r.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return a.sent(),[3,5];case 3:return i=a.sent(),Gr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),[4,ih(t,i)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof _s?t.qr.X(e):e instanceof Ss?t.qr.rt(e):t.qr.et(e),n.isEqual(ri.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,tc(t.localStore)];case 8:return o=a.sent(),n.compareTo(o)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(fi.EMPTY_BYTE_STRING,n.snapshotVersion)),Xc(t,e);var r=new Ha(n.target,e,1,n.sequenceNumber);Yc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return Gr("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,ih(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}}))}))}function ih(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i=this;return(0,r.c)(this,(function(o){switch(o.label){case 0:if(!Va(e))throw e;return t.Or.add(1),[4,zc(t)];case 1:return o.sent(),t.Br.set("Offline"),n||(n=function(){return tc(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return(0,r.b)(i,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return Gr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Qc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function oh(t,e){return e().catch((function(n){return ih(t,n,e)}))}function sh(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n,i,o,s;return(0,r.c)(this,(function(r){switch(r.label){case 0:e=Xr(t),n=yh(e),i=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,r.label=1;case 1:if(!function(t){return Zc(t)&&t.Fr.length<10}(e))return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,nc(e.localStore,i)];case 3:return null===(o=r.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(i=o.batchId,function(t,e){t.Fr.push(e);var n=yh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=r.sent(),[4,ih(e,s)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return ah(e)&&uh(e),[2]}}))}))}function ah(t){return Zc(t)&&!yh(t).tr()&&t.Fr.length>0}function uh(t){yh(t).start()}function ch(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){return yh(t).Ar(),[2]}))}))}function hh(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n,i,o;return(0,r.c)(this,(function(r){for(e=yh(t),n=0,i=t.Fr;n<i.length;n++)o=i[n],e.Er(o.mutations);return[2]}))}))}function lh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:return i=t.Fr.shift(),o=za.from(i,e,n),[4,oh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return r.sent(),[4,sh(t)];case 2:return r.sent(),[2]}}))}))}function fh(t,e){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(n){switch(n.label){case 0:return e&&yh(t).pr?[4,function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return ss(i=e.code)&&i!==qr.ABORTED?(n=t.Fr.shift(),yh(t).sr(),[4,oh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return r.sent(),[4,sh(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return ah(t)&&uh(t),[2]}}))}))}function dh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Xr(t),e?(n.Or.delete(2),[4,Qc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,zc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function ph(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Xr(t);return r.br(),new qc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:eh.bind(null,t),Ri:nh.bind(null,t),_r:rh.bind(null,t)}),t.Mr.push((function(n){return(0,r.b)(e,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Jc(t)?$c(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),th(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function yh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Xr(t);return r.br(),new jc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ch.bind(null,t),Ri:fh.bind(null,t),Ir:hh.bind(null,t),Tr:lh.bind(null,t)}),t.Mr.push((function(n){return(0,r.b)(e,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,sh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(Gr("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var gh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ra,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function vh(t,e){if(Qr("AsyncQueue",e+": "+t),Va(t))return new jr(qr.UNAVAILABLE,e+": "+t);throw t}var mh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ei.comparator(e.key,n.key)}:function(t,e){return Ei.comparator(t.key,e.key)},this.keyedMap=gs(),this.sortedSet=new us(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),wh=function(){function t(){this.Qr=new us(Ei.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Wr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),bh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,mh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&wo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Th=function(){this.Wr=void 0,this.listeners=[]},Ih=function(){this.queries=new Lu((function(t){return bo(t)}),wo),this.onlineState="Unknown",this.Gr=new Set};function Eh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u,c;return(0,r.c)(this,(function(r){switch(r.label){case 0:if(n=Xr(t),i=e.query,o=!1,(s=n.queries.get(i))||(o=!0,s=new Th),!o)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),a=s,[4,n.onListen(i)];case 2:return a.Wr=r.sent(),[3,4];case 3:return u=r.sent(),c=vh(u,"Initialization of query '"+To(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(i,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&Nh(n),[2]}}))}))}function _h(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a;return(0,r.c)(this,(function(r){return n=Xr(t),i=e.query,o=!1,(s=n.queries.get(i))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(i),n.onUnlisten(i))]:[2]}))}))}function Sh(t,e){for(var n=Xr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&Nh(n)}function Dh(t,e,n){var r=Xr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Nh(t){t.Gr.forEach((function(t){t.next()}))}var Ah=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new bh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=bh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),kh=function(t){this.key=t},Ch=function(t){this.key=t},xh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ws(),this.mutatedKeys=ws(),this.lo=Eo(t),this.fo=new mh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new wh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=ho(this.query)&&i.size===this.query.limit?i.last():null,c=lo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Io(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),ho(this.query)||lo(this.query))for(;s.size>this.query.limit;){var h=ho(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new bh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new wh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ws(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new Ch(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new kh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ws();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return bh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Rh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Lh=function(t){this.key=t,this.bo=!1},Oh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Lu((function(t){return bo(t)}),wo),this.Vo=new Map,this.So=new Set,this.Do=new us(Ei.comparator),this.Co=new Map,this.No=new hc,this.xo={},this.ko=new Map,this.Fo=Tu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Ph(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=hl(t),(s=n.Po.get(e))?(i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,rc(n.localStore,vo(e))];case 2:return a=r.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.targetId,[4,Fh(n,e,i,"current"===u)];case 3:o=r.sent(),n.isPrimaryClient&&Hc(n.remoteStore,a),r.label=4;case 4:return[2,o]}}))}))}function Fh(t,e,n,i){return(0,r.b)(this,void 0,void 0,(function(){var o,s,a,u,c,h;return(0,r.c)(this,(function(l){switch(l.label){case 0:return t.Oo=function(e,n,i){return function(t,e,n,i){return(0,r.b)(this,void 0,void 0,(function(){var o,s,a;return(0,r.c)(this,(function(r){switch(r.label){case 0:return(o=e.view._o(n)).Nn?[4,oc(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,o)}))]:[3,2];case 1:o=r.sent(),r.label=2;case 2:return s=i&&i.targetChanges.get(e.targetId),a=e.view.applyChanges(o,t.isPrimaryClient,s),[2,(Yh(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,i)},[4,oc(t.localStore,e,!0)];case 1:return o=l.sent(),s=new xh(e,o.Bn),a=s._o(o.documents),u=Es.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),Yh(t,n,c.To),h=new Rh(e,n,s),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}}))}))}function Mh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Xr(t),i=n.Po.get(e),(o=n.Vo.get(i.targetId)).length>1?[2,(n.Vo.set(i.targetId,o.filter((function(t){return!wo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)?[3,2]:[4,ic(n.localStore,i.targetId,!1).then((function(){n.sharedClientState.clearQueryState(i.targetId),Wc(n.remoteStore,i.targetId),Hh(n,i.targetId)})).catch(Du)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return Hh(n,i.targetId),[4,ic(n.localStore,i.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}function Vh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a;return(0,r.c)(this,(function(r){switch(r.label){case 0:i=ll(t),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,function(t,e){var n,r=Xr(t),i=ni.now(),o=e.reduce((function(t,e){return t.add(e.key)}),ws());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Ho(c,n.get(c.key));null!=h&&s.push(new $o(c.key,h,Ui(h.value.mapValue),Bo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(i.localStore,e)];case 2:return o=r.sent(),i.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new us(Zr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(i,o.batchId,n),[4,Jh(i,o.changes)];case 3:return r.sent(),[4,sh(i.remoteStore)];case 4:return r.sent(),[3,6];case 5:return s=r.sent(),a=vh(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}}))}))}function Uh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i;return(0,r.c)(this,(function(r){switch(r.label){case 0:n=Xr(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,ec(n.localStore,e)];case 2:return i=r.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Yr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Yr(r.bo):t.removedDocuments.size>0&&(Yr(r.bo),r.bo=!1))})),[4,Jh(n,i,e)];case 3:return r.sent(),[3,6];case 4:return[4,Du(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function qh(t,e,n){var r=Xr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Xr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&Nh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function jh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return(0,r.c)(this,(function(r){switch(r.label){case 0:return(i=Xr(t)).sharedClientState.updateQueryState(e,"rejected",n),o=i.Co.get(e),(s=o&&o.key)?(a=(a=new us(Ei.comparator)).insert(s,qi.newNoDocument(s,ri.min())),u=ws().add(s),c=new Is(ri.min(),new Map,new ls(Zr),a,u),[4,Uh(i,c)]):[3,2];case 1:return r.sent(),i.Do=i.Do.remove(s),i.Co.delete(e),$h(i),[3,4];case 2:return[4,ic(i.localStore,e,!1).then((function(){return Hh(i,e,n)})).catch(Du)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}function Bh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:n=Xr(t),i=e.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,Zu(n.localStore,e)];case 2:return o=r.sent(),zh(n,i,null),Qh(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),[4,Jh(n,o)];case 3:return r.sent(),[3,6];case 4:return[4,Du(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Kh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:i=Xr(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Yr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(i.localStore,e)];case 2:return o=r.sent(),zh(i,e,n),Qh(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),[4,Jh(i,o)];case 3:return r.sent(),[3,6];case 4:return[4,Du(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Gh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a;return(0,r.c)(this,(function(r){switch(r.label){case 0:Zc((n=Xr(t)).remoteStore)||Gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,function(t){var e=Xr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(i=r.sent())?[2,void e.resolve()]:((o=n.ko.get(i)||[]).push(e),n.ko.set(i,o),[3,4]);case 3:return s=r.sent(),a=vh(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}}))}))}function Qh(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function zh(t,e,n){var r=Xr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Hh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Wh(t,e)}))}function Wh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Wc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),$h(t))}function Yh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof kh?(t.No.addReference(o.key,e),Xh(t,o)):o instanceof Ch?(Gr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Wh(t,o.key)):Wr()}}function Xh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Gr("SyncEngine","New document in limbo: "+n),t.So.add(r),$h(t))}function $h(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ei(ui.fromString(e)),r=t.Fo.next();t.Co.set(r,new Lh(n)),t.Do=t.Do.insert(n,r),Hc(t.remoteStore,new Ha(vo(co(n.path)),r,2,Ur.o))}}function Jh(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a;return(0,r.c)(this,(function(u){switch(u.label){case 0:return i=Xr(t),o=[],s=[],a=[],i.Po.isEmpty()?[3,3]:(i.Po.forEach((function(t,r){a.push(i.Oo(r,e,n).then((function(t){if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(r.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=Wu.Pn(r.targetId,t);s.push(e)}})))})),[4,Promise.all(a)]);case 1:return u.sent(),i.vo._r(o),[4,function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h,l;return(0,r.c)(this,(function(r){switch(r.label){case 0:n=Xr(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return La.forEach(e,(function(e){return La.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return La.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return r.sent(),[3,4];case 3:if(!Va(i=r.sent()))throw i;return Gr("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.kn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.kn=n.kn.insert(u,l));return[2]}}))}))}(i.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))}function Zh(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return(n=Xr(t)).currentUser.isEqual(e)?[3,3]:(Gr("SyncEngine","User change. New user:",e.toKey()),[4,Ju(n.localStore,e)]);case 1:return i=r.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new jr(qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),[4,Jh(n,i.Ln)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}function tl(t,e){var n=Xr(t),r=n.Co.get(e);if(r&&r.bo)return ws().add(r.key);var i=ws(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function el(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,oc((n=Xr(t)).localStore,e.query,!0)];case 1:return i=r.sent(),o=e.view.Ao(i),[2,(n.isPrimaryClient&&Yh(n,e.targetId,o.To),o)]}}))}))}function nl(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){return[2,ac((e=Xr(t)).localStore).then((function(t){return Jh(e,t)}))]}))}))}function rl(t,e,n,i){return(0,r.b)(this,void 0,void 0,(function(){var o,s;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,function(t,e){var n=Xr(t),r=Xr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):La.resolve(null)}))}))}((o=Xr(t)).localStore,e)];case 1:return null===(s=r.sent())?[3,6]:"pending"!==n?[3,3]:[4,sh(o.remoteStore)];case 2:return r.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(zh(o,e,i||null),Qh(o,e),function(t,e){Xr(Xr(t)._n).Gt(e)}(o.localStore,e)):Wr(),r.label=4;case 4:return[4,Jh(o,s)];case 5:return r.sent(),[3,7];case 6:Gr("SyncEngine","Cannot apply mutation batch with id: "+e),r.label=7;case 7:return[2]}}))}))}function il(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h;return(0,r.c)(this,(function(r){switch(r.label){case 0:return hl(n=Xr(t)),ll(n),!0!==e||!0===n.$o?[3,3]:(i=n.sharedClientState.getAllActiveQueryTargets(),[4,ol(n,i.toArray())]);case 1:return o=r.sent(),n.$o=!0,[4,dh(n.remoteStore,!0)];case 2:for(r.sent(),s=0,a=o;s<a.length;s++)u=a[s],Hc(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Hh(n,e),ic(n.localStore,e,!0)})),Wc(n.remoteStore,e)})),[4,h]);case 4:return r.sent(),[4,ol(n,c)];case 5:return r.sent(),function(t){var e=Xr(t);e.Co.forEach((function(t,n){Wc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new us(Ei.comparator)}(n),n.$o=!1,[4,dh(n.remoteStore,!1)];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))}function ol(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h,l,f,d,p,y,g;return(0,r.c)(this,(function(r){switch(r.label){case 0:n=Xr(t),i=[],o=[],s=0,a=e,r.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,rc(n.localStore,vo(h[0]))]:[3,7]):[3,13];case 2:c=r.sent(),l=0,f=h,r.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,el(n,p)]):[3,6];case 4:(y=r.sent()).snapshot&&o.push(y.snapshot),r.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,sc(n.localStore,u)];case 8:return g=r.sent(),[4,rc(n.localStore,g)];case 9:return c=r.sent(),[4,Fh(n,sl(g),u,!1)];case 10:r.sent(),r.label=11;case 11:i.push(c),r.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),i)]}}))}))}function sl(t){return uo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function al(t){var e=Xr(t);return Xr(Xr(e.localStore).persistence).fn()}function ul(t,e,n,i){return(0,r.b)(this,void 0,void 0,(function(){var o,s,a;return(0,r.c)(this,(function(r){switch(r.label){case 0:return(o=Xr(t)).$o?(Gr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,ac(o.localStore)];case 3:return s=r.sent(),a=Is.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Jh(o,s,a)];case 4:return r.sent(),[3,8];case 5:return[4,ic(o.localStore,e,!0)];case 6:return r.sent(),Hh(o,e,i),[3,8];case 7:Wr(),r.label=8;case 8:return[2]}}))}))}function cl(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return(0,r.c)(this,(function(p){switch(p.label){case 0:if(!(i=hl(t)).$o)return[3,10];o=0,s=e,p.label=1;case 1:return o<s.length?(a=s[o],i.Vo.has(a)?(Gr("SyncEngine","Adding an already active target "+a),[3,5]):[4,sc(i.localStore,a)]):[3,6];case 2:return u=p.sent(),[4,rc(i.localStore,u)];case 3:return c=p.sent(),[4,Fh(i,sl(u),c.targetId,!1)];case 4:p.sent(),Hc(i.remoteStore,c),p.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,r.c)(this,(function(e){switch(e.label){case 0:return i.Vo.has(t)?[4,ic(i.localStore,t,!1).then((function(){Wc(i.remoteStore,t),Hh(i,t)})).catch(Du)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,p.label=7;case 7:return l<f.length?(d=f[l],[5,h(d)]):[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function hl(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jh.bind(null,e),e.vo._r=Sh.bind(null,e.eventManager),e.vo.Mo=Dh.bind(null,e.eventManager),e}function ll(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Kh.bind(null,e),e}var fl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return this.R=Mc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return $u(this.persistence,new Yu,t.initialUser,this.R)},t.prototype.qo=function(t){return new gc(mc.bs,this.R)},t.prototype.Bo=function(t){return new kc},t.prototype.terminate=function(){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),dl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,r._)(e,t),e.prototype.initialize=function(e){return(0,r.b)(this,void 0,void 0,(function(){var n=this;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,uc(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,ll(this.Qo.syncEngine)];case 4:return r.sent(),[4,sh(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return $u(this.persistence,new Yu,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new ku(e,t.asyncQueue)},e.prototype.qo=function(t){var e=zu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?du.withCacheSize(this.cacheSizeBytes):du.DEFAULT;return new Ku(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Pc(),Fc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new kc},e}(fl),pl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,r._)(e,t),e.prototype.initialize=function(e){return(0,r.b)(this,void 0,void 0,(function(){var n,i=this;return(0,r.c)(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Ac?(this.sharedClientState.syncEngine={ui:rl.bind(null,n),ai:ul.bind(null,n),hi:cl.bind(null,n),fn:al.bind(null,n),ci:nl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He((function(t){return(0,r.b)(i,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return[4,il(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return o.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=Pc();if(!Ac.yt(e))throw new jr(qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=zu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ac(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(dl),yl=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n=this;return(0,r.c)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return qh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Zh.bind(null,this.syncEngine),[4,dh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Ih},t.prototype.createDatastore=function(t){var e,n=Mc(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new Oc(e));return function(t,e,n){return new Bc(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return qh(s.syncEngine,t,0)},o=xc.yt()?new xc:new Cc,new Gc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Oh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return e=Xr(t),Gr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,zc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),gl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),vl=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n=this;return(0,r.c)(this,(function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o,s,a,u;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Xr(t),i=Gs(n.R)+"/documents",o={documents:e.map((function(t){return qs(n.R,t)}))},[4,n.$i("BatchGetDocuments",i,o)];case 1:return s=r.sent(),a=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Yr(!!e.found),e.found.name,e.found.updateTime;var n=js(t,e.found.name),r=Ms(e.found.updateTime),i=new Vi({mapValue:{fields:e.found.fields}});return qi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Yr(!!e.missing),Yr(!!e.readTime);var n=js(t,e.missing),r=Ms(e.readTime);return qi.newNoDocument(n,r)}(t,e):Wr()}(n.R,t);a.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());Yr(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=i.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new rs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,r.b)(this,void 0,void 0,(function(){var t,e=this;return(0,r.c)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Ei.fromPath(n);e.mutations.push(new is(r,e.precondition(r)))})),[4,function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Xr(t),i=Gs(n.R)+"/documents",o={writes:e.map((function(t){return Hs(n.R,t)}))},[4,n.Ni("Commit",i,o)];case 1:return r.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Wr();e=ri.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Bo.updateTime(e):Bo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ri.min()))throw new jr(qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bo.updateTime(e)}return Bo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),ml=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Vc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return(0,r.b)(t,void 0,void 0,(function(){var t,e,n=this;return(0,r.c)(this,(function(r){return t=new vl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!bi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ss(e)}return!1},t}(),wl=function(){function t(t,e,n){var i=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=wc.UNAUTHENTICATED,this.clientId=Jr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return(0,r.b)(i,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return Gr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new jr(qr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ra;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return(0,r.b)(t,void 0,void 0,(function(){var t,n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=vh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function bl(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i,o=this;return(0,r.c)(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Gr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=s.sent(),[4,e.initialize(n)];case 2:return s.sent(),i=n.initialUser,t.setCredentialChangeListener((function(t){return(0,r.b)(o,void 0,void 0,(function(){return(0,r.c)(this,(function(n){switch(n.label){case 0:return i.isEqual(t)?[3,2]:[4,Ju(e.localStore,t)];case 1:n.sent(),i=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Tl(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i;return(0,r.c)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Il(t)];case 1:return n=o.sent(),Gr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return i=o.sent(),[4,e.initialize(n,i)];case 3:return o.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return(0,r.b)(this,void 0,void 0,(function(){var n,i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return(n=Xr(t)).asyncQueue.verifyOperationInProgress(),Gr("RemoteStore","RemoteStore received new credentials"),i=Zc(n),n.Or.add(3),[4,zc(n)];case 1:return r.sent(),i&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return r.sent(),n.Or.delete(3),[4,Qc(n)];case 3:return r.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function Il(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Gr("FirestoreClient","Using default OfflineComponentProvider"),[4,bl(t,new fl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function El(t){return(0,r.b)(this,void 0,void 0,(function(){return(0,r.c)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Gr("FirestoreClient","Using default OnlineComponentProvider"),[4,Tl(t,new yl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function _l(t){return Il(t).then((function(t){return t.persistence}))}function Sl(t){return Il(t).then((function(t){return t.localStore}))}function Dl(t){return El(t).then((function(t){return t.remoteStore}))}function Nl(t){return El(t).then((function(t){return t.syncEngine}))}function Al(t){return(0,r.b)(this,void 0,void 0,(function(){var e,n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,El(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Ph.bind(null,e.syncEngine),n.onUnlisten=Mh.bind(null,e.syncEngine),n)]}}))}))}function kl(t,e,n){var i=this;void 0===n&&(n={});var o=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(i,void 0,void 0,(function(){var i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return i=function(t,e,n,r,i){var o=new gl({next:function(o){e.enqueueAndForget((function(){return _h(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new jr(qr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new jr(qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Ah(co(n.path),o,{includeMetadataChanges:!0,so:!0});return Eh(t,s)},[4,Al(t)];case 1:return[2,i.apply(void 0,[r.sent(),t.asyncQueue,e,n,o])]}}))}))})),o.promise}function Cl(t,e,n){var i=this;void 0===n&&(n={});var o=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(i,void 0,void 0,(function(){var i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return i=function(t,e,n,r,i){var o=new gl({next:function(n){e.enqueueAndForget((function(){return _h(t,s)})),n.fromCache&&"server"===r.source?i.reject(new jr(qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Ah(n,o,{includeMetadataChanges:!0,so:!0});return Eh(t,s)},[4,Al(t)];case 1:return[2,i.apply(void 0,[r.sent(),t.asyncQueue,e,n,o])]}}))}))})),o.promise}var xl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Rl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Ll=new Map,Ol=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Pl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(wc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Fl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ml=function(){function t(t){var e=this;this.currentUser=wc.UNAUTHENTICATED,this.oc=new Ra,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){Gr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Gr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Gr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Yr("string"==typeof n.accessToken),new Ol(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return(0,r.b)(n,void 0,void 0,(function(){return(0,r.c)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Yr(null===t||"string"==typeof t),new wc(t)},t}(),Vl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=wc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Ul=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Vl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(wc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ql(t,e,n){if(!n)throw new jr(qr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function jl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new jr(qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Bl(t,e,n,r){if(!0===e&&!0===r)throw new jr(qr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Kl(t){if(!Ei.isDocumentKey(t))throw new jr(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Gl(t){if(Ei.isDocumentKey(t))throw new jr(qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ql(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Wr()}function zl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jr(qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ql(t);throw new jr(qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Hl(t,e){if(e<=0)throw new jr(qr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Wl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Bl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Yl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1,t instanceof Rl?(this._databaseId=t,this._credentials=new Pl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rl(t.options.projectId)}(t),this._credentials=new Ml(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new jr(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new jr(qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Pl;switch(t.type){case"gapi":var e=t.client;return Yr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ul(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new jr(qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Ll.get(this))&&(Gr("ComponentProvider","Removing Datastore"),Ll.delete(this),t.terminate()),Promise.resolve();var t},t}(),Xl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Jl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),$l=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Jl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,co(r))||this)._path=r,i.type="collection",i}return(0,r._)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Xl(this.firestore,null,new Ei(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}($l);function Zl(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=(0,r.n)(t),ql("collection","path",e),t instanceof Yl)return Gl(n=ui.fromString.apply(ui,(0,r.a)([e],i))),new Jl(t,null,n);if(!(t instanceof Xl||t instanceof Jl))throw new jr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Gl(n=ui.fromString.apply(ui,(0,r.a)([t.path],i)).child(ui.fromString(e))),new Jl(t.firestore,null,n)}function tf(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=(0,r.n)(t),1===arguments.length&&(e=Jr.u()),ql("doc","path",e),t instanceof Yl)return Kl(n=ui.fromString.apply(ui,(0,r.a)([e],i))),new Xl(t,null,new Ei(n));if(!(t instanceof Xl||t instanceof Jl))throw new jr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Kl(n=t._path.child(ui.fromString.apply(ui,(0,r.a)([e],i)))),new Xl(t.firestore,t instanceof Jl?t.converter:null,new Ei(n))}function ef(t,e){return t=(0,r.n)(t),e=(0,r.n)(e),(t instanceof Xl||t instanceof Jl)&&(e instanceof Xl||e instanceof Jl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function nf(t,e){return t=(0,r.n)(t),e=(0,r.n)(e),t instanceof $l&&e instanceof $l&&t.firestore===e.firestore&&wo(t._query,e._query)&&t.converter===e.converter}var rf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Vc(this,"async_queue_retry"),this.Ic=function(){var e=Fc();e&&Gr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Fc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=Fc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new Ra;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return(0,r.b)(this,void 0,void 0,(function(){var t,e=this;return(0,r.c)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Va(t=n.sent()))throw t;return Gr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,Qr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=gh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Wr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,r.b)(this,void 0,void 0,(function(){var t;return(0,r.c)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function of(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var sf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new rf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,r._)(e,t),e.prototype._terminate=function(){return this._firestoreClient||uf(this),this._firestoreClient.terminate()},e}(Yl);function af(t){return t._firestoreClient||uf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function uf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new xl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new wl(t._credentials,t._queue,r)}function cf(t,e,n){var i=this,o=new Ra;return t.asyncQueue.enqueue((function(){return(0,r.b)(i,void 0,void 0,(function(){var i;return(0,r.c)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,bl(t,n)];case 1:return r.sent(),[4,Tl(t,e)];case 2:return r.sent(),o.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===qr.FAILED_PRECONDITION||t.code===qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(i=r.sent()))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),o.reject(i),[3,4];case 4:return[2]}}))}))})).then((function(){return o.promise}))}function hf(t){if(t._initialized||t._terminated)throw new jr(qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var lf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new jr(qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),ff=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(fi.fromBase64String(e))}catch(e){throw new jr(qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(fi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),df=function(t){this._methodName=t},pf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new jr(qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new jr(qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Zr(this._lat,t._lat)||Zr(this._long,t._long)},t}(),yf=/^__.*__$/,gf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new $o(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xo(t,this.data,e,this.fieldTransforms)},t}(),vf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new $o(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function mf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wr()}}var wf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return Uf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(mf(this.Nc)&&yf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),bf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Mc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new wf({Nc:t,methodName:e,qc:n,path:hi.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Tf(t){var e=t._freezeSettings(),n=Mc(t._databaseId);return new bf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function If(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Pf("Data must be an object, but it was:",s,r);var a,u,c=Lf(r,s);if(o.merge)a=new li(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Ff(e,f[l],n);if(!s.contains(d))throw new jr(qr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");qf(h,d)||h.push(d)}a=new li(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new gf(new Vi(c),a,u)}var Ef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(df);function _f(t,e,n){return new wf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Sf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype._toFieldTransform=function(t){return new qo(t.path,new Ro)},e.prototype.isEqual=function(t){return t instanceof e},e}(df),Df=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,r._)(e,t),e.prototype._toFieldTransform=function(t){var e=_f(this,t,!0),n=this.Kc.map((function(t){return Rf(t,e)})),r=new Lo(n);return new qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(df),Nf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,r._)(e,t),e.prototype._toFieldTransform=function(t){var e=_f(this,t,!0),n=this.Kc.map((function(t){return Rf(t,e)})),r=new Po(n);return new qo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(df),Af=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,r._)(e,t),e.prototype._toFieldTransform=function(t){var e=new Mo(t.R,No(t.R,this.Qc));return new qo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(df);function kf(t,e,n,i){var o=t.Uc(1,e,n);Pf("Data must be an object, but it was:",o,i);var s=[],a=Vi.empty();oi(i,(function(t,i){var u=Vf(e,t,n);i=(0,r.n)(i);var c=o.Oc(u);if(i instanceof Ef)s.push(u);else{var h=Rf(i,c);null!=h&&(s.push(u),a.set(u,h))}}));var u=new li(s);return new vf(a,u,o.fieldTransforms)}function Cf(t,e,n,i,o,s){var a=t.Uc(1,e,n),u=[Ff(e,i,n)],c=[o];if(s.length%2!=0)throw new jr(qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<s.length;h+=2)u.push(Ff(e,s[h])),c.push(s[h+1]);for(var l=[],f=Vi.empty(),d=u.length-1;d>=0;--d)if(!qf(l,u[d])){var p=u[d],y=c[d];y=(0,r.n)(y);var g=a.Oc(p);if(y instanceof Ef)l.push(p);else{var v=Rf(y,g);null!=v&&(l.push(p),f.set(p,v))}}var m=new li(l);return new vf(f,m,a.fieldTransforms)}function xf(t,e,n,r){return void 0===r&&(r=!1),Rf(n,t.Uc(r?4:3,e))}function Rf(t,e){if(Of(t=(0,r.n)(t)))return Pf("Unsupported field value:",e,t),Lf(t,e);if(t instanceof df)return function(t,e){if(!mf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Rf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,r.n)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return No(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ni.fromDate(t);return{timestampValue:Os(e.R,n)}}if(t instanceof ni)return n=new ni(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Os(e.R,n)};if(t instanceof pf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ff)return{bytesValue:Ps(e.R,t._byteString)};if(t instanceof Xl){n=e.databaseId;var i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Lc("Document reference is for database "+i.projectId+"/"+i.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Vs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Ql(t))}(t,e)}function Lf(t,e){var n={};return si(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oi(t,(function(t,r){var i=Rf(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Of(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ni||t instanceof pf||t instanceof ff||t instanceof Xl||t instanceof df)}function Pf(t,e,n){if(!Of(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ql(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function Ff(t,e,n){if((e=(0,r.n)(e))instanceof lf)return e._internalPath;if("string"==typeof e)return Vf(t,e);throw Uf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Mf=new RegExp("[~\\*/\\[\\]]");function Vf(t,e,n){if(e.search(Mf)>=0)throw Uf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(lf.bind.apply(lf,(0,r.a)([void 0],e.split(".")))))._internalPath}catch(r){throw Uf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Uf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new jr(qr.INVALID_ARGUMENT,(a+=". ")+t+u)}function qf(t,e){return t.some((function(t){return t.isEqual(e)}))}var jf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Xl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Bf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Kf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(jf);function Kf(t,e){return"string"==typeof e?Vf(t,e):e instanceof lf?e._internalPath:e._delegate._internalPath}var Gf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Qf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,r._)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new zf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Kf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(jf),zf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Qf),Hf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Gf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new zf(n._firestore,n._userDataWriter,r.key,r,new Gf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new jr(qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new zf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Gf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new zf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Gf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Wf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Wf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wr()}}function Yf(t,e){return t instanceof Qf&&e instanceof Qf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Hf&&e instanceof Hf&&t._firestore===e._firestore&&nf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Xf(t){if(lo(t)&&0===t.explicitOrderBy.length)throw new jr(qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var $f=function(){};function Jf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,r._)(e,t),e.prototype._apply=function(t){var e=Tf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new jr(qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){sd(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(od(r,t,l))}a={arrayValue:{values:u}}}else a=od(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||sd(s,o),a=xf(n,"where",s,"in"===o||"not-in"===o);var f=zi.create(i,o,a);return function(t,e){if(e.g()){var n=po(t);if(null!==n&&!n.isEqual(e.field))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=fo(t);null!==r&&ad(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new jr(qr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new jr(qr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new $l(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}($f),td=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,r._)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ro(e,n);return function(t,e){if(null===fo(t)){var n=po(t);null!==n&&ad(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new $l(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new ao(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}($f),ed=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,r._)(e,t),e.prototype._apply=function(t){return new $l(t.firestore,t.converter,mo(t._query,this.Hc,this.Jc))},e}($f),nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,r._)(e,t),e.prototype._apply=function(t){var e=id(t,this.type,this.Yc,this.Xc);return new $l(t.firestore,t.converter,function(t,e){return new ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}($f),rd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,r._)(e,t),e.prototype._apply=function(t){var e=id(t,this.type,this.Yc,this.Xc);return new $l(t.firestore,t.converter,function(t,e){return new ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}($f);function id(t,e,n,i){if(n[0]=(0,r.n)(n[0]),n[0]instanceof jf)return function(t,e,n,r,i){if(!r)throw new jr(qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=go(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(xi(e,r.key));else{var c=r.data.field(u.field);if(vi(c))throw new jr(qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new eo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,i);var o=Tf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new jr(qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!yo(t)&&-1!==c.indexOf("/"))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ui.fromString(c));if(!Ei.isDocumentKey(h))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ei(h);a.push(xi(e,l))}else{var f=xf(n,r,c);a.push(f)}}return new eo(a,o)}(t._query,t.firestore._databaseId,o,e,n,i)}function od(t,e,n){if("string"==typeof(n=(0,r.n)(n))){if(""===n)throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!yo(e)&&-1!==n.indexOf("/"))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var i=e.path.child(ui.fromString(n));if(!Ei.isDocumentKey(i))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+i+"' is not because it has an odd number of segments ("+i.length+").");return xi(t,new Ei(i))}if(n instanceof Xl)return xi(t,n._key);throw new jr(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ql(n)+".")}function sd(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new jr(qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ad(t,e,n){if(!n.isEqual(e))throw new jr(qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var ud=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),_i(t)){case 0:return null;case 1:return t.booleanValue;case 2:return yi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(gi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Wr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return oi(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new pf(yi(t.latitude),yi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=mi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(wi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=pi(t);return new ni(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ui.fromString(t);Yr(ua(n));var r=new Rl(n.get(1),n.get(3)),i=new Ei(n.popFirst(5));return r.isEqual(e)||Qr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function cd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var hd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r._)(e,t),e.prototype.convertBytes=function(t){return new ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xl(this.firestore,null,e)},e}(ud),ld=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Tf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=fd(t,this._firestore),i=cd(r.converter,e,n),o=If(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Bo.none())),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,a=fd(t,this._firestore);return s="string"==typeof(e=(0,r.n)(e))||e instanceof lf?Cf(this._dataReader,"WriteBatch.update",a._key,e,n,i):kf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,Bo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=fd(t,this._firestore);return this._mutations=this._mutations.concat(new rs(e._key,Bo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new jr(qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function fd(t,e){if((t=(0,r.n)(t)).firestore!==e)throw new jr(qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r._)(e,t),e.prototype.convertBytes=function(t){return new ff(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xl(this.firestore,null,e)},e}(ud);function pd(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];t=zl(t,Xl);var s=zl(t.firestore,sf),a=Tf(s);return gd(s,[("string"==typeof(e=(0,r.n)(e))||e instanceof lf?Cf(a,"updateDoc",t._key,e,n,i):kf(a,"updateDoc",t._key,e)).toMutation(t._key,Bo.exists(!0))])}function yd(t){for(var e,n,i,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];t=(0,r.n)(t);var a={includeMetadataChanges:!1},u=0;"object"!=typeof o[u]||of(o[u])||(a=o[u],u++);var c,h,l,f={includeMetadataChanges:a.includeMetadataChanges};if(of(o[u])){var d=o[u];o[u]=null===(e=d.next)||void 0===e?void 0:e.bind(d),o[u+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),o[u+2]=null===(i=d.complete)||void 0===i?void 0:i.bind(d)}if(t instanceof Xl)h=zl(t.firestore,sf),l=co(t._key.path),c={next:function(e){o[u]&&o[u](vd(h,t,e))},error:o[u+1],complete:o[u+2]};else{var p=zl(t,$l);h=zl(p.firestore,sf),l=p._query;var y=new dd(h);c={next:function(t){o[u]&&o[u](new Hf(h,y,p,t))},error:o[u+1],complete:o[u+2]},Xf(t._query)}return function(t,e,n,i){var o=this,s=new gl(i),a=new Ah(e,s,n);return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(o,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return e=Eh,[4,Al(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))})),function(){s.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(o,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return e=_h,[4,Al(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))}))}}(af(h),l,f,c)}function gd(t,e){return function(t,e){var n=this,i=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return n=Vh,[4,Nl(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,i])]}}))}))})),i.promise}(af(t),e)}function vd(t,e,n){var r=n.docs.get(e._key),i=new dd(t);return new Qf(t,i,e._key,r,new Gf(n.hasPendingWrites,n.fromCache),e.converter)}var md=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,r._)(e,t),e.prototype.get=function(e){var n=this,r=fd(e,this._firestore),i=new dd(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Qf(n._firestore,i,r._key,t._document,new Gf(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Tf(t)}return t.prototype.get=function(t){var e=this,n=fd(t,this._firestore),r=new hd(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Wr();var i=t[0];if(i.isFoundDocument())return new jf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new jf(e._firestore,r,n._key,null,n.converter);throw Wr()}))},t.prototype.set=function(t,e,n){var r=fd(t,this._firestore),i=cd(r.converter,e,n),o=If(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,a=fd(t,this._firestore);return s="string"==typeof(e=(0,r.n)(e))||e instanceof lf?Cf(this._dataReader,"Transaction.update",a._key,e,n,i):kf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=fd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function wd(){if("undefined"==typeof Uint8Array)throw new jr(qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function bd(){if("undefined"==typeof atob)throw new jr(qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Td=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return bd(),new t(ff.fromBase64String(e))},t.fromUint8Array=function(e){return wd(),new t(ff.fromUint8Array(e))},t.prototype.toBase64=function(){return bd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return wd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Id=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){hf(t=zl(t,sf));var n=af(t),r=t._freezeSettings(),i=new yl;return cf(n,i,new dl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){hf(t=zl(t,sf));var e=af(t),n=t._freezeSettings(),r=new yl;return cf(e,r,new pl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new jr(qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ra;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return(0,r.b)(e,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return Pa.yt()?(e=t+"main",[4,Pa.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(zu(t._databaseId,t._persistenceKey))];case 1:return i.sent(),n.resolve(),[3,3];case 2:return e=i.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),Ed=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Rl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||zr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,i){var o;void 0===i&&(i={});var s=(t=zl(t,Yl))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&zr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:e+":"+n,ssl:!1})),i.mockUserToken){var a,u;if("string"==typeof i.mockUserToken)a=i.mockUserToken,u=wc.MOCK_USER;else{a=(0,r.o)(i.mockUserToken,null===(o=t._app)||void 0===o?void 0:o.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new jr(qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new wc(c)}t._credentials=new Fl(new Ol(a,u))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,r.b)(e,void 0,void 0,(function(){var e,n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,_l(t)];case 1:return e=r.sent(),[4,Dl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Xr(t);return e.Or.delete(0),Qc(e)}(n))]}}))}))}))}(af(zl(this._delegate,sf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,r.b)(e,void 0,void 0,(function(){var e,n;return(0,r.c)(this,(function(i){switch(i.label){case 0:return[4,_l(t)];case 1:return e=i.sent(),[4,Dl(t)];case 2:return n=i.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,r.b)(this,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return(e=Xr(t)).Or.add(0),[4,zc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(af(zl(this._delegate,sf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Bl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(e,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(r){switch(r.label){case 0:return e=Gh,[4,Nl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(af(zl(this._delegate,sf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,i=new gl(e);return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.add(e),e.next()},[4,Al(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}}))}))})),function(){i.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var e;return(0,r.c)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.delete(e)},[4,Al(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}}))}))}))}}(af(t=zl(t,sf)),of(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new jr(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Md(this,Zl(this._delegate,t))}catch(t){throw kd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Ad(this,tf(this._delegate,t))}catch(t){throw kd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Od(this,function(t,e){if(t=zl(t,Yl),ql("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new jr(qr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new $l(t,null,function(t){return new ao(ui.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw kd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,i=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var n;return(0,r.c)(this,(function(r){switch(r.label){case 0:return[4,function(t){return El(t).then((function(t){return t.datastore}))}(t)];case 1:return n=r.sent(),new ml(t.asyncQueue,n,e,i).run(),[2]}}))}))})),i.promise}(af(t),(function(n){return e(new md(t,n))}))}(this._delegate,(function(n){return t(new Sd(e,n))}))},t.prototype.batch=function(){var t=this;return af(this._delegate),new Dd(new ld(this._delegate,(function(e){return gd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new jr(qr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new jr(qr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),_d=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r._)(e,t),e.prototype.convertBytes=function(t){return new Td(new ff(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Ad.eu(e,this.firestore,null)},e}(ud),Sd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new _d(t)}return t.prototype.get=function(t){var e=this,n=Vd(t);return this._delegate.get(n).then((function(t){return new Rd(e._firestore,new Qf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Vd(t);return n?(jl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Vd(t);return 2===arguments.length?this._delegate.update(a,e):(i=this._delegate).update.apply(i,(0,r.a)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Vd(t);return this._delegate.delete(e),this},t}(),Dd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Vd(t);return n?(jl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Vd(t);return 2===arguments.length?this._delegate.update(a,e):(i=this._delegate).update.apply(i,(0,r.a)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Vd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Nd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new zf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ld(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new _d(e),n),i.set(n,o)),o},t}();Nd.su=new WeakMap;var Ad=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new _d(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new jr(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Xl(n._delegate,r,new Ei(e)))},t.eu=function(e,n,r){return new t(n,new Xl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Md(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Md(this.firestore,Zl(this._delegate,t))}catch(t){throw kd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,r.n)(t))instanceof Xl&&ef(this._delegate,t)},t.prototype.set=function(t,e){e=jl("DocumentReference.set",e);try{return function(t,e,n){t=zl(t,Xl);var r=zl(t.firestore,sf),i=cd(t.converter,e,n);return gd(r,[If(Tf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Bo.none())])}(this._delegate,t,e)}catch(t){throw kd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];try{return 1===arguments.length?pd(this._delegate,t):pd.apply(void 0,(0,r.a)([this._delegate,t,e],n))}catch(t){throw kd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return gd(zl((t=this._delegate).firestore,sf),[new rs(t._key,Bo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Cd(e),i=xd(e,(function(e){return new Rd(t.firestore,new Qf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return yd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=zl(t,Xl);var e=zl(t.firestore,sf),n=af(e),i=new dd(e);return function(t,e){var n=this,i=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var n;return(0,r.c)(this,(function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o;return(0,r.c)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(o=r.sent()).isFoundDocument()?n.resolve(o):o.isNoDocument()?n.resolve(null):n.reject(new jr(qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=r.sent(),o=vh(i,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}}))}))},[4,Sl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,i])]}}))}))})),i.promise}(n,t._key).then((function(n){return new Qf(e,i,t._key,n,new Gf(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=zl(t,Xl);var e=zl(t.firestore,sf);return kl(af(e),t._key,{source:"server"}).then((function(n){return vd(e,t,n)}))}(this._delegate):function(t){t=zl(t,Xl);var e=zl(t.firestore,sf);return kl(af(e),t._key).then((function(n){return vd(e,t,n)}))}(this._delegate)).then((function(t){return new Rd(e.firestore,new Qf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(Nd.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function kd(t,e,n){return t.message=t.message.replace(e,n),t}function Cd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!of(r))return r}return{}}function xd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=of(t[0])?t[0]:of(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Rd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Ad(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Yf(this._delegate,t._delegate)},t}(),Ld=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r._)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Rd),Od=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new _d(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Jf(this._delegate,function(t,e,n){var r=e,i=Kf("where",t);return new Zf(i,r,n)}(e,n,r)))}catch(e){throw kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Jf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Kf("orderBy",t);return new td(r,n)}(e,n)))}catch(e){throw kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Jf(this._delegate,function(t){return Hl("limit",t),new ed("limit",t,"F")}(e)))}catch(e){throw kd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Jf(this._delegate,function(t){return Hl("limitToLast",t),new ed("limitToLast",t,"L")}(e)))}catch(e){throw kd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw kd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw kd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rd("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw kd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rd("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw kd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return nf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=zl(t,$l);var e=zl(t.firestore,sf),n=af(e),i=new dd(e);return function(t,e){var n=this,i=new Ra;return t.asyncQueue.enqueueAndForget((function(){return(0,r.b)(n,void 0,void 0,(function(){var n;return(0,r.c)(this,(function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,r.b)(this,void 0,void 0,(function(){var i,o,s,a,u;return(0,r.c)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,oc(t,e,!0)];case 1:return u=r.sent(),i=new xh(e,u.Bn),o=i._o(u.documents),s=i.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=r.sent(),u=vh(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,Sl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,i])]}}))}))})),i.promise}(n,t._query).then((function(n){return new Hf(e,i,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=zl(t,$l);var e=zl(t.firestore,sf),n=af(e),r=new dd(e);return Cl(n,t._query,{source:"server"}).then((function(n){return new Hf(e,r,t,n)}))}(this._delegate):function(t){t=zl(t,$l);var e=zl(t.firestore,sf),n=af(e),r=new dd(e);return Xf(t._query),Cl(n,t._query).then((function(n){return new Hf(e,r,t,n)}))}(this._delegate)).then((function(t){return new Fd(e.firestore,new Hf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Cd(e),i=xd(e,(function(e){return new Fd(t.firestore,new Hf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return yd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(Nd.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),Pd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ld(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Fd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Od(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Ld(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new Pd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Ld(n._firestore,r))}))},t.prototype.isEqual=function(t){return Yf(this._delegate,t._delegate)},t}(),Md=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,r._)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Ad(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Ad(this.firestore,void 0===t?tf(this._delegate):tf(this._delegate,t))}catch(t){throw kd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=zl(t.firestore,sf),r=tf(t),i=cd(t.converter,e);return gd(n,[If(Tf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Bo.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new Ad(e.firestore,t)}))},e.prototype.isEqual=function(t){return ef(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(Nd.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(Od);function Vd(t){return zl(t,Xl)}var Ud,qd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(lf.bind.apply(lf,(0,r.a)([void 0],t)))}return t.documentId=function(){return new t(hi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,r.n)(t))instanceof lf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),jd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Sf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Ef("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Df("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Nf("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Af("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Bd={Firestore:Ed,GeoPoint:pf,Timestamp:ni,Blob:Td,Transaction:Sd,WriteBatch:Dd,DocumentReference:Ad,DocumentSnapshot:Rd,Query:Od,QueryDocumentSnapshot:Ld,QuerySnapshot:Fd,CollectionReference:Md,FieldPath:qd,FieldValue:jd,setLogLevel:function(t){var e;e=t,Br.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new r.C("firestore",(function(t){return function(t,e){return new Ed(t,new sf(t,e),new Id)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Bd)))})(Ud=r.f),Ud.registerVersion("@firebase/firestore","2.4.0")}}]);